{"componentChunkName":"component---src-templates-post-tsx","path":"/springboot-jwt-tutorial2/","result":{"data":{"markdownRemark":{"html":"<h2 id=\"1-401-unauthorized-해결을-위한-security-설정\" style=\"position:relative;\"><a href=\"#1-401-unauthorized-%ED%95%B4%EA%B2%B0%EC%9D%84-%EC%9C%84%ED%95%9C-security-%EC%84%A4%EC%A0%95\" aria-label=\"1 401 unauthorized 해결을 위한 security 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 401 Unauthorized 해결을 위한 Security 설정</h2>\n<h3 id=\"securityconfig-생성\" style=\"position:relative;\"><a href=\"#securityconfig-%EC%83%9D%EC%84%B1\" aria-label=\"securityconfig 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecurityConfig 생성</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bd81378fcf36fb8eae680949e83efd48/64639/2-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.405405405405407%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDklEQVQY022Q6U7DMBCE8zSQ+L6PxGkrCIFKff/XGdapgkDix6fJ2srOeIZH2vEIH/jMO2J5h2kb0rJhSxvK7Q5z2cHjCpEuEOUGma9g3GCcDCZmfzjnQYmALCuczJhUPGAyQIun9pmrBK4TmM5Eoh/7Qvtn4cnAucMXpdmJLAu4TRAEpyRTWGFiQ7QZlUy5Xyhtw8ifif5jmOhSqgBjMgQhc4MsK3SaobWHpETeVUTC+RmK0L7CkhoyMH22hWrw4ML3hQ4jPeH1RUGmBXa/w68r3NzglysCaQ0ZS5hRyci1N0Q6t66QWT4Mta2HSqpmkIri/+6BDHpHPfnYv0/D496BkTLS3uHrqI9nntr5BpcPvUHCEJqHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/bd81378fcf36fb8eae680949e83efd48/fcda8/2-1.png\"\n        srcset=\"/static/bd81378fcf36fb8eae680949e83efd48/12f09/2-1.png 148w,\n/static/bd81378fcf36fb8eae680949e83efd48/e4a3f/2-1.png 295w,\n/static/bd81378fcf36fb8eae680949e83efd48/fcda8/2-1.png 590w,\n/static/bd81378fcf36fb8eae680949e83efd48/efc66/2-1.png 885w,\n/static/bd81378fcf36fb8eae680949e83efd48/c83ae/2-1.png 1180w,\n/static/bd81378fcf36fb8eae680949e83efd48/64639/2-1.png 1568w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>config 패키지를 생성한뒤, SecurityConfig 클래스를 작성합니다.</p>\n<ul>\n<li>\n<p>SecurityConfigurer 설정을 위한 두가지 방법</p>\n<ol>\n<li><code class=\"language-text\">WebSecurityConfigurer</code> 를 <code class=\"language-text\">implements</code> 하기</li>\n<li><code class=\"language-text\">WebSecurityConfigurerAdapter</code> 를 <code class=\"language-text\">extends</code> 하기</li>\n</ol>\n<p>위 코드에서는 2번째 방법으로 어댑터 클래스를 상속받아서 구현한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">configure(HttpSecurity http)</code> 메소드 오바라이딩</p>\n<p>상속받은 클래스 내부를 보면, configure 함수가 오버로딩되어있는데, 이 코드에서는 HTTPSecurity 를 매개변수로 가지는 함수를 오버라이딩하여 작성한다.</p>\n</li>\n<li>\n<p><code class=\"language-text\">authorizeRequests()</code></p>\n<ul>\n<li>HttpServletRequest 를 사용한 요청들에 대한 접근제한</li>\n<li>\n<p>HttpServletRequest?</p>\n<p>JSP 기본 내장 객체 중 <strong>request 객체는 JSP에서 가장 많이 사용되는 객체</strong>입니다.</p>\n<p>웹브라우저 사용자인 클라이언트로부터 서버로 요청이 들어오면 서버에서는 <strong>HttpServletRequest</strong>  를 생성하며, 요청정보에 있는 패스로 매핑된 서블릿에게 전달합니다.</p>\n<p>이렇게 전달받은 내용들을 파라미터로 Get과 Post 형식으로 클라이언트에게 전달합니다.</p>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">antMatchers(path).permitAll()</code></p>\n<ul>\n<li>해당 path 는 인증없이(permitAll) 접근허용한다.</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">anyRequest().authenticated()</code></p>\n<ul>\n<li>그외 나머지 요청들은 인증되어야한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"postman으로-테스트\" style=\"position:relative;\"><a href=\"#postman%EC%9C%BC%EB%A1%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"postman으로 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Postman으로 테스트</h3>\n<ul>\n<li>GET - localhost:8080/api/hello</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ea13cddcf88d6151fae90502f151df15/6c86f/2-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.864864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAgElEQVQI122NWQoDMQxDc/97FuZjlsZ2nNVRk0xbKFTwkIRt7M59h/cMUgVxwDMEkAR4EuTSUOpNtY7aOpoBohGUFJwiZHBIxeMq4NjgrvPAtm0gIjDzYmaRO4fhWQOmeu+LkfCr8agW1IGbVVOGxrRGZvY9nMxu9vH/tPdOzhkvxxjqt+wq8RIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/ea13cddcf88d6151fae90502f151df15/fcda8/2-2.png\"\n        srcset=\"/static/ea13cddcf88d6151fae90502f151df15/12f09/2-2.png 148w,\n/static/ea13cddcf88d6151fae90502f151df15/e4a3f/2-2.png 295w,\n/static/ea13cddcf88d6151fae90502f151df15/fcda8/2-2.png 590w,\n/static/ea13cddcf88d6151fae90502f151df15/efc66/2-2.png 885w,\n/static/ea13cddcf88d6151fae90502f151df15/c83ae/2-2.png 1180w,\n/static/ea13cddcf88d6151fae90502f151df15/6c86f/2-2.png 1720w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>위와 같이 문자열 “hello” 가 반환이 된것을 볼수있습니다.</p>\n<h2 id=\"2-datasource-jpa-설정\" style=\"position:relative;\"><a href=\"#2-datasource-jpa-%EC%84%A4%EC%A0%95\" aria-label=\"2 datasource jpa 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Datasource, JPA 설정</h2>\n<h3 id=\"properties-→-yml-로-변경\" style=\"position:relative;\"><a href=\"#properties-%E2%86%92-yml-%EB%A1%9C-%EB%B3%80%EA%B2%BD\" aria-label=\"properties → yml 로 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>properties → yml 로 변경</h3>\n<p>기본적으로 스프링부트는 key - value 형식을 사용하는 <a href=\"http://application.properties\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">application.properties</a> 파일이 있습니다.</p>\n<p>키에 동일한 접두사를 사용하여, 계층적 데이터를 표현합니다.</p>\n<p>해당 파일의 각 라인은 단일 구성이고, 모든 키는 spring.datasource에 속합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">spring.datasource.url=jdbc:h2:dev\nspring.datasource.username=SA\nspring.datasource.password=password</code></pre></div>\n<p>YAML 형식은 계층적 구성 데이터를 지정하기 편리한 형식입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> password\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> jdbc<span class=\"token punctuation\">:</span>h2<span class=\"token punctuation\">:</span>dev\n        <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> SA</code></pre></div>\n<p>따라서 위 두가지 차이를 보면, YAML 형식은 가독성이 좋고, 하나의 파일로, 프로필을 구분할 수 있는 장점이있다.</p>\n<p>보기 좋은 것을 선호하면 YAML 형식을 사용하거나, 이전 형식대로 사용해도 상관없습니다.</p>\n<p>인텔리제이의 Refactor를 이용해 application.properties 의 확장자를 yml로 변경합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ecc0625edd7ee4a72a82d106d404a87f/d69c4/2-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 97.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAACNElEQVQ4y51U23abMBDkU3pOYyPA4iouBhkwGGNSt07Tpu1DXvr/HzHdle0mp23cOA+DbCFGuzO7a91mA+6LCVIq2E4I14sJEVw3gvMGWJlfoI0b+AuFhZdg7gSYiQCCyN8Ca+4GWAYlfup7PJR7KLqgCipDzgeujlC4Id4LCSULlEQcy4zWCpII7dOtfFCc4PDeJUIm+JSNGJI16riGu4hx4/iw6SLW0WhJEjhO8ER2IXKLP5hUjzHdYOr36FYDtusJQztBtyMK3WO+oPT9FIIM+2+EbEIdrbBPtxhUh9t8ix05P6Y9hNIQxRrzrMGMYPuZifQiIae2TTr8WO7xUHyAyjRcP8GNLU2qgtM940KqZ60tFl7JHE1Uk9sVfRTBFkf9xL/wQrmcSa2UymSdtJiREew2b3qs1dnVF+CezvwVIT8+Zlt8p5Tv8h1GMmhKerQUsVIVtO5QNwNW9QZl1UGvelrX5n9LpvEekz+lTBquwpUhZJjSoTb0owKLMDPwyOU/wSTn388bwHKob7kWP1N0d9kOnWrhqAJ+2UAWGp4qSdPLreg809YQVmGFx/KAL/mEiUpmJnzMZ9LAuPyKlvudMk8WrkUdanyjsjlQ17BJKq2QL5ur+9n0MjvMpXNPEe7TAVrV0CR6EObXE7J+CZEFixS+p2goKPPCk0exxbXTZow3eFweUEUa72zP6Me62fOjflfPw6ZR+FpP2JAZfdqhIf1kskTY9Gb1qIQ8GgyefB1+AV9YUmSouRNsAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/ecc0625edd7ee4a72a82d106d404a87f/fcda8/2-3.png\"\n        srcset=\"/static/ecc0625edd7ee4a72a82d106d404a87f/12f09/2-3.png 148w,\n/static/ecc0625edd7ee4a72a82d106d404a87f/e4a3f/2-3.png 295w,\n/static/ecc0625edd7ee4a72a82d106d404a87f/fcda8/2-3.png 590w,\n/static/ecc0625edd7ee4a72a82d106d404a87f/efc66/2-3.png 885w,\n/static/ecc0625edd7ee4a72a82d106d404a87f/d69c4/2-3.png 1002w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>H2 데이터베이스를 사용할 것 이고, 메모리에 데이터를 저장합니다.</p>\n<ul>\n<li>\n<p>h2.console.enabled</p>\n<ul>\n<li>h2 콘솔 페이지 활성화</li>\n</ul>\n</li>\n<li>\n<p>jpa.hibernate.ddl-auto</p>\n<ul>\n<li>Hibernate 초기화 전략, create-drop 은 인-메모리 DB 기본 전략입니다.</li>\n<li>SessionFactory가 시작될 때, Drop, Create, Alter 종료될때 Drop</li>\n</ul>\n</li>\n<li>\n<p>jpa.properties.hibernate</p>\n<ul>\n<li>콘솔창에서 sql 문을 보기좋게 출력</li>\n</ul>\n</li>\n<li>\n<p>logging.level</p>\n<ul>\n<li>log4j 의 로그레벨은 ALL &#x3C; DEBUG &#x3C; INFO &#x3C; WARN &#x3C; ERROR &#x3C; FATAL &#x3C; OFF 순으로 지정.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"3-entity-생성\" style=\"position:relative;\"><a href=\"#3-entity-%EC%83%9D%EC%84%B1\" aria-label=\"3 entity 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Entity 생성</h2>\n<p>entity 패키지를 생성하고, User, Authority 를 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token annotation punctuation\">@Builder</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> userId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"username\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> unique <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"nickname\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> nickname<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"activated\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">boolean</span> activated<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToMany</span>\n    <span class=\"token annotation punctuation\">@JoinTable</span><span class=\"token punctuation\">(</span>\n            name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_authority\"</span><span class=\"token punctuation\">,</span>\n            joinColumns <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> referencedColumnName <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            inverseJoinColumns <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"authority_name\"</span><span class=\"token punctuation\">,</span> referencedColumnName <span class=\"token operator\">=</span> <span class=\"token string\">\"authority_name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Authority</span><span class=\"token punctuation\">></span></span> authorities<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>jwttutorial<span class=\"token punctuation\">.</span>entity</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">lombok<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Column</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Entity</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Id</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">javax<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Table</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"authority\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token annotation punctuation\">@Builder</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Authority</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"authority_name\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> authorityName<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/12e05fbde36df2c28afaaedd16f3645e/6e52c/2-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABQElEQVQY01WRX0+DMBTF+f4fx2cTffHBuajR/WETBnTAgA62gWW60f4sTI02OTm9Off0puc6Y1fwGhXMkoqXSBIVO4zWdF3H/2MGaKude83oP5K+6Jad0cTjYebztBR42Z5N1VhTZ02asRtz/TDl+v6V0TLhKSho1HEw75oPwqxiLa1np0ird8pa4UTBinDl486mbJIY3Z05nT5p2yOTZcB4suBxusCLc2J5oHlXQ49v66vbkR044W4acfPsMRc5jhCCMAjouW1b+9gJpRR1XSOLnH1VUpVbZJ5RbiWHw2HoK6yWpungC8MQ3/eH2skKSZrl9JwV1rgtMcYMOQVJziKIma8EbrBm5oWo9jjEtmsUsc07kRf09+2+xvHFBk+kvEUJ7mpNkkv7JZvh+WwXoy/QxkKj7aDuWzM/i/hFT4Yvf27Dx6C9ASIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/12e05fbde36df2c28afaaedd16f3645e/fcda8/2-4.png\"\n        srcset=\"/static/12e05fbde36df2c28afaaedd16f3645e/12f09/2-4.png 148w,\n/static/12e05fbde36df2c28afaaedd16f3645e/e4a3f/2-4.png 295w,\n/static/12e05fbde36df2c28afaaedd16f3645e/fcda8/2-4.png 590w,\n/static/12e05fbde36df2c28afaaedd16f3645e/efc66/2-4.png 885w,\n/static/12e05fbde36df2c28afaaedd16f3645e/c83ae/2-4.png 1180w,\n/static/12e05fbde36df2c28afaaedd16f3645e/6e52c/2-4.png 1948w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>User 클래스를 보면 @ManyToMany, @JoinTable 은 유저와 권한 객체의 다대다 관계를 위 테이블 처럼 일대다, 다대일 관계의 조인 테이블로 정의했습니다. </p>\n<p>이 부분은 추후 강의자의 JPA 강의에서 자세히 설명합니다. </p>\n<h3 id=\"datasql-생성\" style=\"position:relative;\"><a href=\"#datasql-%EC%83%9D%EC%84%B1\" aria-label=\"datasql 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>data.sql 생성</h3>\n<p>편의를 위해, 서버를 시작할때마다 Data를 자동으로 DB에 넣어주는 기능을 활용하겠습니다.</p>\n<p> resource 폴더 밑에 data.sql 파일을 만들겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token keyword\">USER</span> <span class=\"token punctuation\">(</span>USER_ID<span class=\"token punctuation\">,</span> USERNAME<span class=\"token punctuation\">,</span> PASSWORD<span class=\"token punctuation\">,</span> NICKNAME<span class=\"token punctuation\">,</span> ACTIVATED<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$2a$08$lDnHPz7eUkSi6ao14Twuau08mzhWrL4kyZGGU5xfiGALO/Vxd5DOi'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token keyword\">USER</span> <span class=\"token punctuation\">(</span>USER_ID<span class=\"token punctuation\">,</span> USERNAME<span class=\"token punctuation\">,</span> PASSWORD<span class=\"token punctuation\">,</span> NICKNAME<span class=\"token punctuation\">,</span> ACTIVATED<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$2a$08$UkVvwpULis18S19S5pZFn.YHPZt3oaqHZnDwqbCW9pft6uFtkXKDC'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> AUTHORITY <span class=\"token punctuation\">(</span>AUTHORITY_NAME<span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ROLE_USER'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> AUTHORITY <span class=\"token punctuation\">(</span>AUTHORITY_NAME<span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'ROLE_ADMIN'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> USER_AUTHORITY <span class=\"token punctuation\">(</span>USER_ID<span class=\"token punctuation\">,</span> AUTHORITY_NAME<span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ROLE_USER'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> USER_AUTHORITY <span class=\"token punctuation\">(</span>USER_ID<span class=\"token punctuation\">,</span> AUTHORITY_NAME<span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ROLE_ADMIN'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> USER_AUTHORITY <span class=\"token punctuation\">(</span>USER_ID<span class=\"token punctuation\">,</span> AUTHORITY_NAME<span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ROLE_USER'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </code></pre></div>\n<h2 id=\"4-h2-console-결과-확인\" style=\"position:relative;\"><a href=\"#4-h2-console-%EA%B2%B0%EA%B3%BC-%ED%99%95%EC%9D%B8\" aria-label=\"4 h2 console 결과 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. H2 Console 결과 확인</h2>\n<p>우리가 만들었던 엔티티들이 DB에 생성이 되는지 확인을 해봅니다. </p>\n<p>그 전에 Security 설정을 추가해줘야지 h2-console 접근을 원할하게 할 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6314369f86eb782b273b83bda8c32d78/78958/2-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.324324324324326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6ElEQVQY02WQS3LEIAxEfZlkjPhYgMH4P5NKdqnc/zYdYVPZZPGq1SBahbrTH3jxgeIWkIkgN97wBOUSjMtwdgQbqeVe1x4ToMhDKX9roxffHbzj5/zGR3rBhRk6rxjKBrd/gfKBUJ4oacFThkaeMUiP5YxeezwU/9G38O5NOSgb8N47kM+wywlOCdRbaGKQoKg+GGBErWDauZNQ26Crh9HVaUa+ps0Ilzfw+QleJXQsiGlFmnYE0RwKtjhjG2cUUS8rWUWXWH0B+wlkEzpy8d6doEh2I1Ou3ehw+Z6ain80aq10/Odrxi/RB5xoydCMDgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/6314369f86eb782b273b83bda8c32d78/fcda8/2-5.png\"\n        srcset=\"/static/6314369f86eb782b273b83bda8c32d78/12f09/2-5.png 148w,\n/static/6314369f86eb782b273b83bda8c32d78/e4a3f/2-5.png 295w,\n/static/6314369f86eb782b273b83bda8c32d78/fcda8/2-5.png 590w,\n/static/6314369f86eb782b273b83bda8c32d78/efc66/2-5.png 885w,\n/static/6314369f86eb782b273b83bda8c32d78/c83ae/2-5.png 1180w,\n/static/6314369f86eb782b273b83bda8c32d78/78958/2-5.png 1320w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>h2-console 하위 모든 요청들과 파비콘 관련 요청은 Spring Security 로직을 수행하지 않고 접근할 수 있도록 </p>\n<p>configure(WebSecurity) 메소드를 오버라이딩 합니다.</p>\n<p>그 후 서버를 시작합니다.</p>\n<ul>\n<li>\n<p>DB 초기화 중 에러 발생</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token operator\">-</span><span class=\"token number\">07</span> <span class=\"token number\">16</span><span class=\"token operator\">:</span><span class=\"token number\">36</span><span class=\"token operator\">:</span><span class=\"token number\">18.468</span>  WARN <span class=\"token number\">2873</span> <span class=\"token operator\">--</span><span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>           main<span class=\"token punctuation\">]</span> <span class=\"token class-name\">ConfigServletWebServerApplicationContext</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">Exception</span> encountered during context initialization <span class=\"token operator\">-</span> cancelling refresh attempt<span class=\"token operator\">:</span> org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>beans<span class=\"token punctuation\">.</span>factory<span class=\"token punctuation\">.</span><span class=\"token class-name\">BeanCreationException</span><span class=\"token operator\">:</span> <span class=\"token class-name\">Error</span> creating bean <span class=\"token keyword\">with</span> <span class=\"token namespace\">name</span> <span class=\"token string\">'dataSourceScriptDatabaseInitializer'</span> defined in <span class=\"token keyword\">class</span> path resource <span class=\"token punctuation\">[</span>org<span class=\"token operator\">/</span>springframework<span class=\"token operator\">/</span>boot<span class=\"token operator\">/</span>autoconfigure<span class=\"token operator\">/</span>sql<span class=\"token operator\">/</span>init<span class=\"token operator\">/</span><span class=\"token class-name\">DataSourceInitializationConfiguration</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token class-name\">Invocation</span> of init method failed<span class=\"token punctuation\">;</span> nested exception is org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>jdbc<span class=\"token punctuation\">.</span>datasource<span class=\"token punctuation\">.</span>init<span class=\"token punctuation\">.</span><span class=\"token class-name\">ScriptStatementFailedException</span><span class=\"token operator\">:</span> <span class=\"token class-name\">Failed</span> <span class=\"token keyword\">to</span> <span class=\"token namespace\">execute</span> SQL script statement #<span class=\"token number\">1</span> of URL <span class=\"token punctuation\">[</span>file<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token class-name\">Users</span><span class=\"token operator\">/</span>seonghun<span class=\"token operator\">/</span><span class=\"token class-name\">Desktop</span><span class=\"token operator\">/</span>dev<span class=\"token operator\">/</span>projects<span class=\"token operator\">/</span>jwt<span class=\"token operator\">-</span>tutorial<span class=\"token operator\">/</span>build<span class=\"token operator\">/</span>resources<span class=\"token operator\">/</span>main<span class=\"token operator\">/</span>data<span class=\"token punctuation\">.</span>sql<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> INSERT <span class=\"token class-name\">INTO</span> USER <span class=\"token punctuation\">(</span>USER_ID<span class=\"token punctuation\">,</span> USERNAME<span class=\"token punctuation\">,</span> PASSWORD<span class=\"token punctuation\">,</span> NICKNAME<span class=\"token punctuation\">,</span> ACTIVATED<span class=\"token punctuation\">)</span> VALUES <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$2a$08$lDnHPz7eUkSi6ao14Twuau08mzhWrL4kyZGGU5xfiGALO/Vxd5DOi'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \nnested exception is org<span class=\"token punctuation\">.</span>h2<span class=\"token punctuation\">.</span>jdbc<span class=\"token punctuation\">.</span><span class=\"token class-name\">JdbcSQLSyntaxErrorException</span><span class=\"token operator\">:</span> <span class=\"token class-name\">Table</span> <span class=\"token string\">\"USER\"</span> not found<span class=\"token punctuation\">;</span> SQL statement<span class=\"token operator\">:</span>\n\nINSERT <span class=\"token class-name\">INTO</span> USER <span class=\"token punctuation\">(</span>USER_ID<span class=\"token punctuation\">,</span> USERNAME<span class=\"token punctuation\">,</span> PASSWORD<span class=\"token punctuation\">,</span> NICKNAME<span class=\"token punctuation\">,</span> ACTIVATED<span class=\"token punctuation\">)</span> VALUES <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$2a$08$lDnHPz7eUkSi6ao14Twuau08mzhWrL4kyZGGU5xfiGALO/Vxd5DOi'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token number\">42102</span><span class=\"token operator\">-</span><span class=\"token number\">200</span><span class=\"token punctuation\">]</span></code></pre></div>\n<br/>\nhibernate 초기화 과정에 에러가 발생했습니다.\n<p>Spring Boot Application 구동하는 과정 중에 <code class=\"language-text\">data.sql</code>을 실행하는 도중, User 테이블을 찾을 수 없어 Insert 구문에서 오류가 발생하는 것인데. </p>\n<p>강의에서 스프링부트의 버전은 2.4이고 현재 2.6 인데 버전이 업데이트 되면서 이러한 오류가 발생하는 듯 합니다.(대부분의 오류는 버전업데이트 관련을 많이겪음)\n<br/></p>\n<ul>\n<li>Hibernate and data.sql 공식 노트 내용 (<a href=\"https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.5-Release-Notes\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">릴리즈 노트 링크)</a></li>\n</ul>\n<blockquote>\n<p>By default, data.sql scripts are now run before Hibernate is initialized. This aligns the behavior of basic script-based initialization with that of Flyway and Liquibase. If you want to use data.sql to populate a schema created by Hibernate, set spring.jpa.defer-datasource-initialization to true. While mixing database initialization technologies is not recommended, this will also allow you to use a schema.sql script to build upon a Hibernate-created schema before it’s populated via data.sql.</p>\n</blockquote>\n<p>Spring Boot 2.5버전 부터 스크립트 기반 초기화의 동작과정을 Flyway, Liquibase와 일치시키기 위해서 <code class=\"language-text\">data.sql</code> 은 Hibernate 초기화되기 전에 실행된다는 내용인것 같습니다.</p>\n<p>따라서 Hibernate 초기화를 통해 생성된 스키마에다가 데이터를 채우기를 위해서 <code class=\"language-text\">data.sql</code>가 실행되기를 원한다면 <strong>application.yml</strong>(또는 properties)에 <strong><code class=\"language-text\">spring.jpa.defer-datasource-initialization</code></strong> 옵션 값을 <strong>true</strong>로 추가해주어야 합니다. </p>\n<p>또는 <code class=\"language-text\">schema.sql</code>을 추가해서 hibernate 가 스키마를 생성하는 과정보다 먼저 실행되도록하여 해당 스키마에 data.sql을 채우도록하는 방법도 있다고 합니다. 그러나 DB 초기화 기술을 혼합하여 사용하는 것은 권장하지 않는 방법이라고 합니다.</p>\n<p>따라서 application.yml 에 <code class=\"language-text\">defer-datasource-initialization: true</code> 옵션을 권장하지 않지만 추가합니다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">01</span><span class=\"token operator\">-</span><span class=\"token number\">07</span> <span class=\"token number\">16</span>:<span class=\"token number\">43</span>:<span class=\"token number\">40.706</span>  INFO <span class=\"token number\">2951</span> <span class=\"token comment\">--- [           main] org.hibernate.dialect.Dialect            : HHH000400: Using dialect: org.hibernate.dialect.H2Dialect</span>\nHibernate: \n    \n    <span class=\"token keyword\">drop</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">if</span> <span class=\"token keyword\">exists</span> authority <span class=\"token keyword\">CASCADE</span> \nHibernate: \n    \n    <span class=\"token keyword\">drop</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">if</span> <span class=\"token keyword\">exists</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">CASCADE</span> \nHibernate: \n    \n    <span class=\"token keyword\">drop</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">if</span> <span class=\"token keyword\">exists</span> user_authority <span class=\"token keyword\">CASCADE</span> \nHibernate: \n    \n    <span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> authority <span class=\"token punctuation\">(</span>\n       authority_name <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>authority_name<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\nHibernate: \n    \n    <span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">user</span> <span class=\"token punctuation\">(</span>\n       user_id <span class=\"token keyword\">bigint</span> generated <span class=\"token keyword\">by</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">identity</span><span class=\"token punctuation\">,</span>\n        activated <span class=\"token keyword\">boolean</span><span class=\"token punctuation\">,</span>\n        nickname <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        password <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        username <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\nHibernate: \n    \n    <span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> user_authority <span class=\"token punctuation\">(</span>\n       user_id <span class=\"token keyword\">bigint</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n        authority_name <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">,</span> authority_name<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\nHibernate: \n    \n    <span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">user</span> \n       <span class=\"token keyword\">add</span> <span class=\"token keyword\">constraint</span> UK_sb8bbouer5wak8vyiiy4pf2bx <span class=\"token keyword\">unique</span> <span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span>\nHibernate: \n    \n    <span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> user_authority \n       <span class=\"token keyword\">add</span> <span class=\"token keyword\">constraint</span> FK6ktglpl5mjosa283rvken2py5 \n       <span class=\"token keyword\">foreign</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>authority_name<span class=\"token punctuation\">)</span> \n       <span class=\"token keyword\">references</span> authority\nHibernate: \n    \n    <span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> user_authority \n       <span class=\"token keyword\">add</span> <span class=\"token keyword\">constraint</span> FKpqlsjpkybgos9w2svcri7j8xy \n       <span class=\"token keyword\">foreign</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">)</span> \n       <span class=\"token keyword\">references</span> <span class=\"token keyword\">user</span></code></pre></div>\n<p>Hibernate DB 초기화 오류를 해결하고 실행을 하니, 로그에 SQL 문을 볼수있습니다. </p>\n<p>이 로그들을 보면, 우리가 만들어둔 Entity 내용들을 기반으로 DB 관련 정보들을 생성하는 쿼리들이 잘 수행 된것을 볼수있습니다.</p>\n<h3 id=\"실제-db-반영-확인\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%EC%A0%9C-db-%EB%B0%98%EC%98%81-%ED%99%95%EC%9D%B8\" aria-label=\"실제 db 반영 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실제 DB 반영 확인</h3>\n<p><a href=\"http://localhost:8080/h2-console\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">localhost:8080/h2-console</a> 에 접속합니다. (인증을 무시하도록 설정했으므로,접속이 잘 되야합니다)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/52fdece3e289fe6db78f867fb0ee06cb/d544a/2-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABE0lEQVQoz6XQ23KCMBCAYd7/5ayAispBkKDYgoAcFfI38TDTXtib7sw3m51kdndiJCJk5WzIswwdvu8xN2dYtkmw8wijgDg5kBwzyrqjGyaafqR9w0iSGNu2EEJQFAXD9cZtlFxvE6+QT+Mk1d3E+AfDjwTrjdowz+n7nv+GoSdOk+4+IqWkrivKKqeqzrRtRdfVDEND1yvdG32t8oWmbTB+95dEYYQ1t5nPLNxNQOCFmB8OO3+NiB3E/iHWopU6r/DdrXq3p8wDDL3Vg+43UeQp+9AnPcacUsHX6cByYeK5S2WBt108s42r6KyHFedP6jL62VDed0wT9Z8nh6bc0RQBtdJW4aNW2jK8e9Uv+t3lHPANws8VBrDe+JEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/52fdece3e289fe6db78f867fb0ee06cb/fcda8/2-6.png\"\n        srcset=\"/static/52fdece3e289fe6db78f867fb0ee06cb/12f09/2-6.png 148w,\n/static/52fdece3e289fe6db78f867fb0ee06cb/e4a3f/2-6.png 295w,\n/static/52fdece3e289fe6db78f867fb0ee06cb/fcda8/2-6.png 590w,\n/static/52fdece3e289fe6db78f867fb0ee06cb/efc66/2-6.png 885w,\n/static/52fdece3e289fe6db78f867fb0ee06cb/c83ae/2-6.png 1180w,\n/static/52fdece3e289fe6db78f867fb0ee06cb/d544a/2-6.png 1950w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>우리가 만들었던 Entity 정보들과 data.sql 파일의 쿼리내용들이 잘 들어와있는것을 볼수있습니다.</p>\n<p>다음 강의에는 JWT 관련 코드들을 작성하겠습니다.</p>\n<h3 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h3>\n<p><a href=\"https://chobopark.tistory.com/43\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">HttpServletRequest 개념</a></p>\n<p><a href=\"https://devgoat.tistory.com/15\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">properties → YAML</a></p>\n<p><a href=\"https://myblog.opendocs.co.kr/archives/950\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">log4j loggin level</a></p>\n<p><a href=\"https://pravusid.kr/java/2018/10/10/spring-database-initialization.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">hibernate ddl-auto 초기화전략</a></p>\n<p><a href=\"https://velog.io/@khsb2012/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-2.5-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-hibernate-data.sql-%EA%B4%80%EB%A0%A8-%EB%B3%80%EB%8F%99%EC%82%AC%ED%95%AD\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">스프링부트 2.5 hibernate data.sql</a></p>","excerpt":"1. 401 Unauthorized 해결을 위한 Security 설정 SecurityConfig 생성  config 패키지를 생성한뒤, SecurityConfig 클래스를 작성합니다. SecurityConfigurer 설정을 위한 두가지 방법  를 …","tableOfContents":"<ul>\n<li>\n<p><a href=\"/springboot-jwt-tutorial2/#1-401-unauthorized-%ED%95%B4%EA%B2%B0%EC%9D%84-%EC%9C%84%ED%95%9C-security-%EC%84%A4%EC%A0%95\">1. 401 Unauthorized 해결을 위한 Security 설정</a></p>\n<ul>\n<li><a href=\"/springboot-jwt-tutorial2/#securityconfig-%EC%83%9D%EC%84%B1\">SecurityConfig 생성</a></li>\n<li><a href=\"/springboot-jwt-tutorial2/#postman%EC%9C%BC%EB%A1%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8\">Postman으로 테스트</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/springboot-jwt-tutorial2/#2-datasource-jpa-%EC%84%A4%EC%A0%95\">2. Datasource, JPA 설정</a></p>\n<ul>\n<li><a href=\"/springboot-jwt-tutorial2/#properties-%E2%86%92-yml-%EB%A1%9C-%EB%B3%80%EA%B2%BD\">properties → yml 로 변경</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/springboot-jwt-tutorial2/#3-entity-%EC%83%9D%EC%84%B1\">3. Entity 생성</a></p>\n<ul>\n<li><a href=\"/springboot-jwt-tutorial2/#datasql-%EC%83%9D%EC%84%B1\">data.sql 생성</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/springboot-jwt-tutorial2/#4-h2-console-%EA%B2%B0%EA%B3%BC-%ED%99%95%EC%9D%B8\">4. H2 Console 결과 확인</a></p>\n<ul>\n<li><a href=\"/springboot-jwt-tutorial2/#%EC%8B%A4%EC%A0%9C-db-%EB%B0%98%EC%98%81-%ED%99%95%EC%9D%B8\">실제 DB 반영 확인</a></li>\n<li><a href=\"/springboot-jwt-tutorial2/#reference\">Reference</a></li>\n</ul>\n</li>\n</ul>","fields":{"slug":"/springboot-jwt-tutorial2/"},"frontmatter":{"title":"SpringBoot JWT 튜토리얼 - 2장 Security 설정, Data 설정","date":"Jan 08, 2022","tags":["SpringBoot","JWT","튜토리얼"],"keywords":["스프링","스프링부트","SpringBoot","JWT","튜토리얼","Tutorial"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/springboot-jwt-tutorial2/","series":[],"lastmod":"2022-01-08"}},"staticQueryHashes":["2027115977","694178885"]}