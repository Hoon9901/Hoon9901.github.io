{"componentChunkName":"component---src-templates-post-tsx","path":"/cert-manager-begin/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"cert-manager\" style=\"position:relative;\"><a href=\"#cert-manager\" aria-label=\"cert manager permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cert-Manager</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/77f959d65a7b998e8ce7277ee7a7a0a0/ab986/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuUlEQVQoz42SS2/TUBCF8+PoCjb9AfAfABHozgskdiwQQl2wpkvEY4OQEKCKQptgJ1GakDqkIU5T/I7fjmN/XBtQW5JKjGak0blzzj1Xd2qu42BZDt7wKT8bNzlt1DFaEuH0FU57i9PmXUz5Fu7oGdHosehvYyp1IvUhofacoFtn1riH371DYuxSK4qcPC/IgiELVyEym/j6VyL3mMSWCYwGC1uBVIf4B6mlEFtNEqdL6H4nNPbFnEI2V1gmOjUuiUJUloNIxsaMntbjUOujWXqFlWfFGp5wWCCS0un5KsFlnlVDj95K3Nje4PqTK2y/e1Bh2TJb4ZRaFxyWwFl/hgexztQcookKE4PLOecE/x78dlxUjx7rMe2RT3voY3vgR6AcubRUm+7YJ0mXK6IrgnEcM5lozB0TaWfKNanFVanDzkeDF591NrYO2JS+sHm/IxynFaf81BXBf28qo68lfPoWstvzObEXnFgJe4OQvb7PwVFA/D8O0zTFNE3mnk8eGkQTsUbH+7AIhJWMWJNxBx/EFg3WmlgrqKoqumnhzVQM+SW6/JosmpMmCebhe6zOG7xJ9w8vvyD6C29l7jKRJscYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/77f959d65a7b998e8ce7277ee7a7a0a0/fcda8/0.png\"\n        srcset=\"/static/77f959d65a7b998e8ce7277ee7a7a0a0/12f09/0.png 148w,\n/static/77f959d65a7b998e8ce7277ee7a7a0a0/e4a3f/0.png 295w,\n/static/77f959d65a7b998e8ce7277ee7a7a0a0/fcda8/0.png 590w,\n/static/77f959d65a7b998e8ce7277ee7a7a0a0/efc66/0.png 885w,\n/static/77f959d65a7b998e8ce7277ee7a7a0a0/c83ae/0.png 1180w,\n/static/77f959d65a7b998e8ce7277ee7a7a0a0/ab986/0.png 2114w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\nCert-Manager는 Kubernetes 내부에서 HTTPS 통신을 위한 인증서를 생성하고 인증서가 만료되면 자동으로 갱신해주는 Certificate Manager Controller 이다.</p>\n<p>해당 문서에서는 Cert-Manager에 대해 간단한 설치 방법과 Kubernetes의 인그레스에 적용하는 방법을 알아본다.\n그리고 ACME의 HTTP01 챌린지가 아닌 DNS01 챌린지를 통해 도메인 검증을 하는 과정을 적용한다.</p>\n<h2 id=\"시작하기-앞서\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-%EC%95%9E%EC%84%9C\" aria-label=\"시작하기 앞서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시작하기 앞서</h2>\n<p>Cert-Manager를 Helm를 통해서 설치한다 설치하는 차트 버전은 1.11 이다.\n<code class=\"language-text\">installCRDs=true</code>를 통해 CRD 또한 함께 설치한다.</p>\n<h3 id=\"설치\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98\" aria-label=\"설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">helm repo <span class=\"token function\">add</span> jetstack https://charts.jetstack.io <span class=\"token operator\">&amp;&amp;</span>\n    helm <span class=\"token function\">install</span> cert-manager jetstack/cert-manager <span class=\"token punctuation\">\\</span>\n        <span class=\"token parameter variable\">--namespace</span> cert-manager <span class=\"token punctuation\">\\</span>\n        --create-namespace <span class=\"token punctuation\">\\</span>\n        <span class=\"token parameter variable\">--version</span> v1.11.0 <span class=\"token punctuation\">\\</span>\n        <span class=\"token parameter variable\">--set</span> <span class=\"token assign-left variable\">installCRDs</span><span class=\"token operator\">=</span>true</code></pre></div>\n<h2 id=\"cert-manager-issuer-생성\" style=\"position:relative;\"><a href=\"#cert-manager-issuer-%EC%83%9D%EC%84%B1\" aria-label=\"cert manager issuer 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cert-Manager Issuer 생성</h2>\n<p>ACME 발급자에 대해 다양한 DNS 공급자가 지원되는데 Cloudflare를 이용해보자.</p>\n<p>토큰은 사용자 프로필 > API 토큰 > API 토큰에서 생성할 수 있다. 다음 설정이 권장된다.</p>\n<ul>\n<li>\n<p>Permissions:</p>\n<ul>\n<li>Zone - DNS - Edit</li>\n<li>Zone - Zone - Read</li>\n</ul>\n</li>\n<li>\n<p>Zone Resources:</p>\n<ul>\n<li>Include - All Zones</li>\n</ul>\n</li>\n</ul>\n<p>새 Issuer를 만들려면 먼저 새 API 토큰을 포함하는 Kubernetes Secret를 만든다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cloudflare<span class=\"token punctuation\">-</span>api<span class=\"token punctuation\">-</span>token<span class=\"token punctuation\">-</span>secret\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> cert<span class=\"token punctuation\">-</span>manager\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Opaque\n<span class=\"token key atrule\">stringData</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">api-token</span><span class=\"token punctuation\">:</span> &lt;API_TOKEN_HERE<span class=\"token punctuation\">></span></code></pre></div>\n<p><code class=\"language-text\">cloudflare-api-token-secret</code> 이름을 가진 Secret 리소스를 생성한다.\napi-token의 value로 cloudflare에서 발급받은 key를 넣어주면된다.\n중요한 부분으로 namespace는 cert-manager가 설치된 곳으로 지정한다. 생략하면 Issuer에서 secret를 참조하지 못한다.</p>\n<p>Cert-Manager에서 제공하는 Issuer는 ClusterIssuer와 그냥 Issuer가 있다 둘의 차이점은 네임스페이스이다. Issuer는 생성된 네임스페이스에서만 적용이 되고 Cluster Issuer는 전체 네임스페이스의 여러 앱에서 사용할 수 있다.</p>\n<p>다음은 두개의 ClusterIssuer를 생성하는 YAML 이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> cert<span class=\"token punctuation\">-</span>manager.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterIssuer\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> letsencrypt<span class=\"token punctuation\">-</span>staging\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">acme</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># The ACME server URL</span>\n    <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//acme<span class=\"token punctuation\">-</span>staging<span class=\"token punctuation\">-</span>v02.api.letsencrypt.org/directory\n    <span class=\"token comment\"># Email address used for ACME registration</span>\n    <span class=\"token key atrule\">email</span><span class=\"token punctuation\">:</span> &lt;Email<span class=\"token punctuation\">></span>\n    <span class=\"token comment\"># Name of a secret used to store the ACME account private key</span>\n    <span class=\"token key atrule\">privateKeySecretRef</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> letsencrypt<span class=\"token punctuation\">-</span>staging\n    <span class=\"token key atrule\">solvers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">dns01</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">cloudflare</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">email</span><span class=\"token punctuation\">:</span> &lt;Email<span class=\"token punctuation\">></span>\n          <span class=\"token key atrule\">apiTokenSecretRef</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cloudflare<span class=\"token punctuation\">-</span>api<span class=\"token punctuation\">-</span>token<span class=\"token punctuation\">-</span>secret\n            <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> api<span class=\"token punctuation\">-</span>token\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> cert<span class=\"token punctuation\">-</span>manager.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterIssuer\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> letsencrypt<span class=\"token punctuation\">-</span>prod\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">acme</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># The ACME server URL</span>\n    <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//acme<span class=\"token punctuation\">-</span>v02.api.letsencrypt.org/directory\n    <span class=\"token comment\"># Email address used for ACME registration</span>\n    <span class=\"token key atrule\">email</span><span class=\"token punctuation\">:</span> &lt;Email<span class=\"token punctuation\">></span>\n    <span class=\"token comment\"># Name of a secret used to store the ACME account private key</span>\n    <span class=\"token key atrule\">privateKeySecretRef</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> letsencrypt<span class=\"token punctuation\">-</span>prod\n\n    <span class=\"token key atrule\">solvers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">dns01</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">cloudflare</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">email</span><span class=\"token punctuation\">:</span> &lt;Email<span class=\"token punctuation\">></span>\n          <span class=\"token key atrule\">apiTokenSecretRef</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cloudflare<span class=\"token punctuation\">-</span>api<span class=\"token punctuation\">-</span>token<span class=\"token punctuation\">-</span>secret\n            <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> api<span class=\"token punctuation\">-</span>token</code></pre></div>\n<p>Let's Encrypt에 대해 스테이징 및 프로덕션의 두 발급자를 설정하는데.</p>\n<p>Let's Encrypt 프로덕션 발급자는 매우 <a href=\"https://letsencrypt.org/docs/rate-limits/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">엄격한 속도 제한</a>이 있다. 실험하고 학습할 때 이러한 한계에 도달하기가 매우 쉽습니다. 이러한 위험 때문에 Let's Encrypt 스테이징 발급자로 시작하고 작동하는 것이 만족스러우면 프로덕션 발급자로 전환한다.</p>\n<h2 id=\"ingress-tls-적용\" style=\"position:relative;\"><a href=\"#ingress-tls-%EC%A0%81%EC%9A%A9\" aria-label=\"ingress tls 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ingress TLS 적용</h2>\n<p>Ingress에 CertManager의 TLS를 적용하기 위해선 YAML 명세 파일에 두가지 부분을 추가하면 된다.</p>\n<p>만약 두개의 서비스를 인그레스로 각각 서브 도메인을 지정한다면 다음과 같은 모습으로 구성된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">-</span>ingress\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">kubernetes.io/ingress.class</span><span class=\"token punctuation\">:</span> nginx\n    <span class=\"token key atrule\">nginx.ingress.kubernetes.io/proxy-body-size</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1000000m\"</span>\n    <span class=\"token key atrule\">cert-manager.io/cluster-issuer</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"letsencrypt-staging\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">tls</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span> \n    <span class=\"token punctuation\">-</span> &lt;domain1<span class=\"token punctuation\">></span>\n    <span class=\"token punctuation\">-</span> &lt;domain2<span class=\"token punctuation\">></span>\n    <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> &lt;TLS_SECRET_NAME<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> &lt;domain1<span class=\"token punctuation\">></span>\n      <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /\n            <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> Prefix\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> &lt;service_name<span class=\"token punctuation\">></span>\n                <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> port1\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> &lt;domain2<span class=\"token punctuation\">></span>\n      <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /\n            <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> Prefix\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> &lt;service_name<span class=\"token punctuation\">></span>\n                <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> port2</code></pre></div>\n<p>annotations 부분에 <code class=\"language-text\">cert-manager.io/cluster-issuer: \"letsencrypt-staging\"</code> 부분을 추가한다. cluster-issuer가 아닌 경우 issuer를 사용하면 된다.\n즉 <code class=\"language-text\">cert-manager.io/issuer</code> 이다.\n그 다음으론 TLS secret를 지정한다 <code class=\"language-text\">secretName: &lt;TLS_SECRET_NAME>&lt;/TLS_SECRET_NAME></code> 해당 Secret은 우리가 생성해야하는 것이 아닌, cert-manager가 생성하는 secret이다. 해당 인그레스를 적용해서 생성하면은 자동으로 Cert-Manager가 해당 Secret Name으로 TLS 비밀키를 생성한다. 생성된 Secret의 데이터는 TLS 관련 개인키와 공개키가 데이터로 포함된다.</p>\n<p>스테이징이 잘 등록되면은 Prod으로 변경한다. 스테이징 인증서로 인그레스 도메인에 접속하면은 신뢰되지 않는 인증서로 등록된다. </p>\n<h2 id=\"tls-적용된-모습\" style=\"position:relative;\"><a href=\"#tls-%EC%A0%81%EC%9A%A9%EB%90%9C-%EB%AA%A8%EC%8A%B5\" aria-label=\"tls 적용된 모습 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TLS 적용된 모습</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 579px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/50e73cbfd8ba3d81018943bed6bfff9a/c08bc/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.51351351351351%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6UlEQVQ4y41TTW/TQBD1v0VwgPYvwAUBdy6cEFA4QYVEBVKRmh4qRCoUCLShEonzaeOs7fjb6919zKyVoiAIHenpjXZ3nsezbx0FoJQGHFEUYz6fw3VdDIdDi+l0itlshtFoZJn31+uTyQRSShhjoLW27KjlN/z49BJBUiAUS/R6n9Hv94l7GAwGtpAxHo+tILPrtjkLep6HMAyJfTRNAwf+R5x29nDhF4CqsVrFyPMMaZrQ12tshqEu9OaK7Uxb5n2H/3Z9RFLSEKRq87oBKjpwiYaBljfW2ryhOifJcoQBzckTCESMkiqsoDJQJHpVaGpMpApO5zzH0+MpXp24OOzH6HyvcEx4f1bgbb/Fu6//B5+78Co4jzoZrj2O8OAgwP0DgTv7S9x7E+H26wQ7z2Psvohxa0/g5jNBHP4VO4TrTwSOzgu6lI2QOPtyivDnDLpKoIoIuozxe8rbo8hTsg0NoFF8e0BelAiWAkVZ0SxrpHmBLC8h6aYUDanRxvK/UNc1HK2NNSTHarVCt9u1xmbDKqXsXmtcc5n/Cd5jSPbhWmwdbFY2L5uVwcLbYqNaS/5lZZ8NB7e8WCwghLC5LTDbO+NZLTMDLyUkZJuyLO2TWQv6vo8gCJBl2dUEqceHHwxu7BvcPQJ+ASuj2GvGLAhAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/50e73cbfd8ba3d81018943bed6bfff9a/c08bc/1.png\"\n        srcset=\"/static/50e73cbfd8ba3d81018943bed6bfff9a/12f09/1.png 148w,\n/static/50e73cbfd8ba3d81018943bed6bfff9a/e4a3f/1.png 295w,\n/static/50e73cbfd8ba3d81018943bed6bfff9a/c08bc/1.png 579w\"\n        sizes=\"(max-width: 579px) 100vw, 579px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n인증서를 letsencrypt-prod으로 등록해서 인그레스를 다시 수정해서 적용하면은 인증서가 정상적으로 등록되는데 만약에 제대로 등록이 안된다면 기존 Secret를 삭제하면된다.</p>\n<p>공식 문서에서 따르면 cert-manager가 감시하고 업데이트된 발급자로 요청을 다시 처리하도록 하는 기존 Secret를 삭제해야 한다고 한다. 이렇게 하면 새 인증서를 받는 프로세스가 시작되고 설명을 사용하여 상태를 볼 수 있다. </p>\n<h1 id=\"레퍼런스\" style=\"position:relative;\"><a href=\"#%EB%A0%88%ED%8D%BC%EB%9F%B0%EC%8A%A4\" aria-label=\"레퍼런스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>레퍼런스</h1>\n<p><a href=\"https://cert-manager.io/docs/tutorials/acme/nginx-ingress/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://cert-manager.io/docs/tutorials/acme/nginx-ingress/</a>\n<a href=\"https://cert-manager.io/docs/configuration/acme/dns01/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://cert-manager.io/docs/configuration/acme/dns01/</a>\n<a href=\"https://github.com/cert-manager/cert-manager/issues/2131\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/cert-manager/cert-manager/issues/2131</a></p>","excerpt":"Cert-Manager \nCert-Manager는 Kubernetes 내부에서 HTTPS 통신을 위한 인증서를 생성하고 인증서가 만료되면 자동으로 갱신해주는 Certificate Manager Controller 이다. 해당 문서에서는 Cert-Ma…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/cert-manager-begin/#cert-manager\">Cert-Manager</a></p>\n<ul>\n<li>\n<p><a href=\"/cert-manager-begin/#%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-%EC%95%9E%EC%84%9C\">시작하기 앞서</a></p>\n<ul>\n<li><a href=\"/cert-manager-begin/#%EC%84%A4%EC%B9%98\">설치</a></li>\n</ul>\n</li>\n<li><a href=\"/cert-manager-begin/#cert-manager-issuer-%EC%83%9D%EC%84%B1\">Cert-Manager Issuer 생성</a></li>\n<li><a href=\"/cert-manager-begin/#ingress-tls-%EC%A0%81%EC%9A%A9\">Ingress TLS 적용</a></li>\n<li><a href=\"/cert-manager-begin/#tls-%EC%A0%81%EC%9A%A9%EB%90%9C-%EB%AA%A8%EC%8A%B5\">TLS 적용된 모습</a></li>\n</ul>\n</li>\n<li><a href=\"/cert-manager-begin/#%EB%A0%88%ED%8D%BC%EB%9F%B0%EC%8A%A4\">레퍼런스</a></li>\n</ul>","fields":{"slug":"/cert-manager-begin/"},"frontmatter":{"title":"Cert-Manager 설치 및 ACME DNS01 챌린지를 통한 Let's encrypt 인증서 발급 및 사용","date":"Mar 14, 2023","tags":["Kubernetes","Cert-Manager"],"keywords":["Kubernetes","쿠버네티스","Cert-Manager","lets","encrypt","TLS","SSL"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/cert-manager-begin/","series":[],"lastmod":"2023-03-14"}},"staticQueryHashes":["2027115977","694178885"]}