{"componentChunkName":"component---src-templates-post-tsx","path":"/aws-s3-image-resize/","result":{"data":{"markdownRemark":{"html":"<p><a href=\"https://hoon9901.github.io/aws-s3-cloudfront/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AWS - S3 리소스를 CloudFront로 캐싱하자</a> 이어서</p>\n<h2 id=\"s3-이미지-리사이징-동작-순서\" style=\"position:relative;\"><a href=\"#s3-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%A6%AC%EC%82%AC%EC%9D%B4%EC%A7%95-%EB%8F%99%EC%9E%91-%EC%88%9C%EC%84%9C\" aria-label=\"s3 이미지 리사이징 동작 순서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>S3 이미지 리사이징 동작 순서</h2>\n<ol>\n<li>클라이언트에서 <strong><code class=\"language-text\">GET /\bimage-url?w=100&amp;h=100&amp;f=webp&amp;q=80</code></strong> 요청을 보냄.</li>\n<li>CDN에서 w, h, f, q 쿼리 파라미터가 붙어있으면 <strong><code class=\"language-text\">Lambda 함수를 트리거</code></strong></li>\n<li>해당 S3 Object(이미지)가 CDN에 캐싱이 되어있으면 해당 이미지를 사용하고, 없다면 S3에서 가져옴.</li>\n<li><strong><code class=\"language-text\">Sharp</code></strong> 모듈을 사용하여 <strong><code class=\"language-text\">w, h, f, q</code></strong> 인자를 통해 원하는 사이즈와 포맷, 품질로 이미지 리사이징</li>\n<li>Base64 형식으로 인코딩하여 클라이언트에게 응답을 리턴</li>\n<li>클라이언트는 응답을 읽어 화면에 렌더링.</li>\n</ol>\n<p>위와 같은 동작을 통해서 원하는 이미지를 얻을 수 있다.\n다음 목차들을 수행하여 구현하는 과정을 나타낸다.</p>\n<h2 id=\"aws-cloud9-환경에서-코드-작성-시\" style=\"position:relative;\"><a href=\"#aws-cloud9-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1-%EC%8B%9C\" aria-label=\"aws cloud9 환경에서 코드 작성 시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS Cloud9 환경에서 코드 작성 시</h2>\n<p>S3 원본 리소스를 이미지 리사이징할 Sharp 노드 모듈을 사용한 코드를 작성한다. 필자는 Cloud9 이라는 AWS IDE 를 사용함.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> querystring <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'querystring'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">AWS</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aws-sdk'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n<span class=\"token keyword\">const</span> Sharp <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sharp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">S3</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWS<span class=\"token punctuation\">.</span>S3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">region</span><span class=\"token operator\">:</span> <span class=\"token string\">'ap-northeast-2'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">BUCKET</span> <span class=\"token operator\">=</span> <span class=\"token string\">'\b버킷 이름'</span><span class=\"token punctuation\">;</span>\n\nexports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">handler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> request<span class=\"token punctuation\">,</span> response <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>Records<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>cf<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Parameters are w, h, f, q and indicate width, height, format and quality.</span>\n  <span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> querystring<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>querystring<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Required width or height value.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>params<span class=\"token punctuation\">.</span>w <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>params<span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Extract name and format.</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> uri <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> request<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> imageName<span class=\"token punctuation\">,</span> extension<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> uri<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\/?(.*)\\.(.*)</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// gif 포맷은 원본 반환</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>extension <span class=\"token operator\">===</span> <span class=\"token string\">'gif'</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>params<span class=\"token punctuation\">.</span>f<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Init variables</span>\n  <span class=\"token keyword\">let</span> width<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> height<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> format<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> quality<span class=\"token punctuation\">;</span> <span class=\"token comment\">// Sharp는 이미지 포맷에 따라서 품질(quality)의 기본값이 다릅니다.</span>\n  <span class=\"token keyword\">let</span> s3Object<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> resizedImage<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Init sizes.</span>\n  width <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  height <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Init quality.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>q<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    quality <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>q<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Init format.</span>\n  format <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span>f <span class=\"token operator\">?</span> params<span class=\"token punctuation\">.</span>f <span class=\"token operator\">:</span> extension<span class=\"token punctuation\">;</span>\n  format <span class=\"token operator\">=</span> format <span class=\"token operator\">===</span> <span class=\"token string\">'jpg'</span> <span class=\"token operator\">?</span> <span class=\"token string\">'jpeg'</span> <span class=\"token operator\">:</span> format<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// For AWS CloudWatch.</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">parmas: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Cannot convert object to primitive value.</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">name: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>imageName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>extension<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Favicon error, if name is `favicon.ico`.</span>\n\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    s3Object <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token constant\">S3</span><span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">Bucket</span><span class=\"token operator\">:</span> <span class=\"token constant\">BUCKET</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">Key</span><span class=\"token operator\">:</span> <span class=\"token function\">decodeURI</span><span class=\"token punctuation\">(</span>imageName <span class=\"token operator\">+</span> <span class=\"token string\">'.'</span> <span class=\"token operator\">+</span> extension<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'S3.getObject: '</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    resizedImage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">Sharp</span><span class=\"token punctuation\">(</span>s3Object<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">resize</span><span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">toFormat</span><span class=\"token punctuation\">(</span>format<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        quality\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">toBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sharp: '</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> resizedImageByteLength <span class=\"token operator\">=</span> Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">byteLength</span><span class=\"token punctuation\">(</span>resizedImage<span class=\"token punctuation\">,</span> <span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'byteLength: '</span><span class=\"token punctuation\">,</span> resizedImageByteLength<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// `response.body`가 변경된 경우 1MB까지만 허용됩니다.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>resizedImageByteLength <span class=\"token operator\">>=</span> <span class=\"token number\">1</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  response<span class=\"token punctuation\">.</span>status <span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span>\n  response<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> resizedImage<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  response<span class=\"token punctuation\">.</span>bodyEncoding <span class=\"token operator\">=</span> <span class=\"token string\">'base64'</span><span class=\"token punctuation\">;</span>\n  response<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">'content-type'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">image/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>format<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>코드를 작성 후에 다음 명령어들을 실행한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">$ npm init <span class=\"token operator\">-</span>y\n$ npm install sharf</code></pre></div>\n<p>그러면 다음과 같이 구성된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 158px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/779403e5c2efeb94fe43c97ecbe65926/c26ae/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeUlEQVQ4y12UWXfSYBCG8x8skIVskEBIAgESIGUt0Jalpa222Krt8UZv9Hjl/z+v800Iohfvmfm2ObM8iaTpNhTNhNOI0B7MUKkFCDrncLwWan4bXitBMr5CPLpExc3Owu45mvEQ9TDmM7NS5xgilqSWLXYU1YCs6FDpoCRrrEJROapYUlEke1aQ/+6TL+7lMYSVNL0CWdXRn645q3S+RSe9QEgZDC62mN++ICXrR32Mrh4wmG1wcfOMyfoR4+v3aLR6nIwIyBmKVBXNgO340IwKlTNEgx7bVJ7fHlDgEVrJGF4zIcXHvazsEbUo5IREdiKW5Ik+kepek2yEihNwr9x6iErVo7UHy67BcX1e12jfpT7nEu8aQRZDSGp3Uwh14hRBq4+X+2v8+LLG7uEZr2/f8PPXb7x+/Y6nj6/YP78hpBI78Tm9IbFN/5EUdQbIFVKp9+s5Xu6WGI4XmC83uFrtsLjcYr19YNuMejh9878ki0aeyyaphgNFd6AbVZ64qlkoU28V9k2+Z9oui33LhWFWD+taPhSTm1pUDIx7TYwSHz4NZ7L6QJO9x2y7x3TzhNlmj95kRSTc8IQFm+n8ls866TwbSj5uIZmySdoBksiHG8QEccpY1MMuusMF2oSTAF9Mm6dOZwIvQUWVps3Y5ECqZRHUQqFURkEuM7AC4mJJY+DfnRVpXWKfISeV6J6s0F2SYPEAtn2kvEx9G13eYbjcMehTgldIwL28+4zF7hMSKlO0YrJ6RNSbEIMG9/gI9ulnIyTKcwWXh7JqQQcufedRf8ogZ4AnvGcRl/n7Y8A8mG7RZE2HSxDks0787Ps+rJVsL/8hnAb9A0cOpIGPCA5uAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/779403e5c2efeb94fe43c97ecbe65926/c26ae/1.png\"\n        srcset=\"/static/779403e5c2efeb94fe43c97ecbe65926/12f09/1.png 148w,\n/static/779403e5c2efeb94fe43c97ecbe65926/c26ae/1.png 158w\"\n        sizes=\"(max-width: 158px) 100vw, 158px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>node_modules를 위해서 cloud9을 사용했지만 로컬 환경에서 npm 구성 후에 람다로 프로젝트를 올려도될것같다.</p>\n<p>이제 동작할 코드 작성은 끝나고 람다를 생성해보자.</p>\n<h2 id=\"로컬-환경에서-코드-작성-시\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EC%BB%AC-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1-%EC%8B%9C\" aria-label=\"로컬 환경에서 코드 작성 시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>로컬 환경에서 코드 작성 시</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6c98c74d4c103cb9c5a0c5c371688566/dba9a/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAChklEQVQ4y42T6W6bQBSFeQDHxoSBYRnAbMNis9jGS+zErtImjVq1lZq/ff/HOL2QREmlqumPoxmQ5tzvnjujLNoduqtbzJstQrkYFMkKQVqhbip8eTjg6vQZzeoGVXtAvlijrHboz6XFEnHeIilepRzP93j8+RXfHn9hd3OP+fKAan09qKRDy3WHpjuiIPNq1WC+qpFmc8RpAdv1wS0Hlu2C2wKmJaA0mwOOt3fYX9/h+OEBRbWhqs1zxSWSsoMs17BMB9pkAkNXwbQxdHWECX1PLjlUzYB2OQEzNSj1usbD9xtq+w7d/ow4qxCmfdsL2tfIFh0V2aIIWqQiRBk58ISLRBZwgwB+JiHSFLF0IGYWlJZa+vxwxunTDyy3J7SbE8pmT9ohJ1o5Xw+Gi4hoXTLwOVxRIElz6kQilTNwrhOhiovRCEooc7T7LXbHj0R5RlF3COKClA8DyhYbZBWZJh72sxi58FGmAeapD5nPEBUBZWnh4mKM8XgMZZaU6NW3GKZz+FFOZuVg2k9bUstlvUUW+Qi5hYBz+OaTTJ3B4IzotCHPJ8Pnwy96KfBi2BP210T6JbjOEQmGqaZCEzGYl9KEGdzQguPqZDjqCV9N3qo37FvOKb8+S90wYRKVrhvDekl0OjNo1cEMA4bBh//K38z+ICSzglqOfcrUi5BH3qAy8QeFnkN0nOLy4Pri34ZvCV3uQp+OYXGiYiYMpsMiMU3HVB3DZFOo6uQ9wifDkia/LBNUYQIvyCjXFmEUIqYc61hilQjI/krZ1v8SdnSZBRzDIyqDDjIIu8+SIRAm7YmYMuZE/36GNOWc7mFEr2JmRZSZjSx0hoEIWr3Yhe1Z9Goseik2fgNSypDSP/ATEgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/6c98c74d4c103cb9c5a0c5c371688566/fcda8/2.png\"\n        srcset=\"/static/6c98c74d4c103cb9c5a0c5c371688566/12f09/2.png 148w,\n/static/6c98c74d4c103cb9c5a0c5c371688566/e4a3f/2.png 295w,\n/static/6c98c74d4c103cb9c5a0c5c371688566/fcda8/2.png 590w,\n/static/6c98c74d4c103cb9c5a0c5c371688566/dba9a/2.png 652w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\ncloud9과 마찬가지로 코드를 작성해서 <code class=\"language-text\">npm install sharf</code> 를 실행하고 zip 으로 파일들을 압축한다.</p>\n<h3 id=\"빌드-환경이-x86_64-생성한-람다-아키텍처이-아닐-경우\" style=\"position:relative;\"><a href=\"#%EB%B9%8C%EB%93%9C-%ED%99%98%EA%B2%BD%EC%9D%B4-x86_64-%EC%83%9D%EC%84%B1%ED%95%9C-%EB%9E%8C%EB%8B%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98%EC%9D%B4-%EC%95%84%EB%8B%90-%EA%B2%BD%EC%9A%B0\" aria-label=\"빌드 환경이 x86_64 생성한 람다 아키텍처이 아닐 경우 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>빌드 환경이 x86_64 (생성한 람다 아키텍처)이 아닐 경우</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f8c1baf140433320399c566108fe6f7/c5bb3/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.027027027027025%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCElEQVQY03WQzW6DMBCEef8X6qU9VL01hypJmxBQQwgYY/4MGAg0pdPB5VpLo/VY3m9H65hxhJASru/Dv1yQyhheKhBUJUSjEdWVVVAVCNe3uNYo+w7KtMg7g4y1GnoMXxOczzKHV2TwWbeE7ZTETgocVAI3kzjSR7pCQUDPhn6aMN7v+O84ktMPCyj500ea4J1AN0txoo6EXgmM+S/UBRNWSNsaZryhHQeY6YZu1fwzM2EQ4BKFTKmwJ+iUKwvaJpFNt5fLEIXns8KDe8VLkOPJF/QpHv2E98T6N9Eh6wh8jUpsvDMyThVNbXe01FCXdlcL9Ko1ZZhqZqoZze1OfVtvVt9P4CqAX+KCdf2j23ouAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/0f8c1baf140433320399c566108fe6f7/fcda8/3.png\"\n        srcset=\"/static/0f8c1baf140433320399c566108fe6f7/12f09/3.png 148w,\n/static/0f8c1baf140433320399c566108fe6f7/e4a3f/3.png 295w,\n/static/0f8c1baf140433320399c566108fe6f7/fcda8/3.png 590w,\n/static/0f8c1baf140433320399c566108fe6f7/c5bb3/3.png 680w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">npm install</code> 을 하고 람다에 배포하면 위와 같은 오류가 발생한다.</p>\n<p>로컬환경에서는 Linux 환경이 아니거나 또는 Apple ARM 일때 <code class=\"language-text\">npm install</code> 시 다음 명령어를 통해서 설치를 해야한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm i --platform=linux --arch=x64 {module}</code></pre></div>\n<p>람다에서 핸들러 경로를 <code class=\"language-text\">path/index.handler</code> 로 지정하면은 해결되긴 한다.\n패키지를 설치하고. 이제 zip 형식으로 압축하여 람다에 업로드하면 되는데. 압축 시 주의사항이 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 547px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fe21a77a789a0af8efcd9e3bfb457ab1/977f7/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVQoz4VR2W7CQAzk/7+sap/aolAKIYEcm/sibMg5HW8D6lstjRxvvOPx7GZeFsRZhr1t49OycA4V/EShcA6I8xS7JIJTZHDKHMcsQdN1SNoG2a1FUFfImQVy1g0DNjUbLmkCy3VxiiP4ZYHk2kB3GuM0oScwT1iGHv04oCPuK9r+zjwaIskLxW0gMc84RgofgQevKrGNApzyDIoK4rZFd60xKR+aShSHVVojba8I+V9I5bvSN0P1S8jQnHipChIWsOIQF66omgpRUxuVI3sGDp6IQWqqlnzre6NQ1BnCnlIFskrM6UL25rl4OZ/wyvypAhzSGO+hhy/6KfWe9Zb54WG92mMIC0oVH7N1hW82i/mHB1jbfByXFpTslfXkjvSX5q42eaby58rzyq5pvMsXPXNdUSsQC3z6amcpHJLKAHn1XayMAFlZfJwehB3VjesL/cUjnmf4P6TvB7ECZO6DGwuIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4\"\n        title=\"4\"\n        src=\"/static/fe21a77a789a0af8efcd9e3bfb457ab1/977f7/4.png\"\n        srcset=\"/static/fe21a77a789a0af8efcd9e3bfb457ab1/12f09/4.png 148w,\n/static/fe21a77a789a0af8efcd9e3bfb457ab1/e4a3f/4.png 295w,\n/static/fe21a77a789a0af8efcd9e3bfb457ab1/977f7/4.png 547w\"\n        sizes=\"(max-width: 547px) 100vw, 547px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n압축을 코드가 위치한 곳에서 상위 디렉터리를 통해서 하면 위와 같은 오류가 발생한다.</p>\n<p>폴더로 압축해선 안되고. 압축 해제 시 파일이 바로 나오도록 압축하면 된다. 그렇게 하면 index.handler를 정상적으로 인식해서 람다가 실행한다</p>\n<h2 id=\"lambda-생성\" style=\"position:relative;\"><a href=\"#lambda-%EC%83%9D%EC%84%B1\" aria-label=\"lambda 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lambda 생성</h2>\n<h3 id=\"코드-업로드\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C-%EC%97%85%EB%A1%9C%EB%93%9C\" aria-label=\"코드 업로드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드 업로드</h3>\n<p>Lambda를 생성하자 버지니아 북부에서 생성해야한다. (서울에서 하면 배포 시  Lambda@Edge가 안뜸)\n필자는 런타임 Node.js 18.x 버전을 선택하였다. </p>\n<p>람다를 생성하면 코드 소스를 업로드하면 된다. Cloud9에서 작업했다면 다음과 같은 방법을 따르고 로컬 환경에서 빌드를 했다면 .zip 파일 형식으로 압축하여 업로드한다.</p>\n<h3 id=\"cloud9에서-람다로-업로드-시\" style=\"position:relative;\"><a href=\"#cloud9%EC%97%90%EC%84%9C-%EB%9E%8C%EB%8B%A4%EB%A1%9C-%EC%97%85%EB%A1%9C%EB%93%9C-%EC%8B%9C\" aria-label=\"cloud9에서 람다로 업로드 시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cloud9에서 람다로 업로드 시</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 345px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/260be348be2337e4067d56af8b32ca3d/e4d6b/5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 141.89189189189187%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEhElEQVRIx31VaXPaSBDlH2ylsk4MCHSfSEKAMLe5BY69vgK+4yTlVFxJ7X7Zn7B//G33CGJjvPuhSyON5s3r7jdvMm/evkNettE5eYRseHD8CkyPolQVT4ufz8ZuuQHd9CDLBjwvQi4nQ7FMuI0SwkqMzDQ5QD85wfjLP7Dph2rcgO3XaOEevKgBJ4jhhvU0xLcmNAGow3YCASjrBpzYhRdEyCwv7zAcz7HzXiIGFTjhngDkseGE8KttAZQvqNjNFrCbK0CisaKagmFeUsRcLq9AKmrI/Pbmd7zdyYqJgmKsQGPYlB6Hbvnie55+5oUchaKeApYo5Twx5HFQgR/WkGl3BwjKMe1cFAsNt0z1igi0Do/qpRgusjS3BsvxxgSurhgya8+PMJ0dYjSZI7O4uEF/OMV7mlgz5BRtvypSzxIDjk1AYqiYsG2uYRGqbqNcqaMWN5GRVqnkJFkACnbUCE5bpE9jWbMF0HOGDOhQjdc1zEsacgUDGf5hHSJl+skJagJIsKXUOe1XAd0wlY1pwvA9NPaoyxuprGrIKYdxF6VKUzTGr7VFB39tzIDqE8NsQUapHGE+n2wDcu1YwFy3NcB6foPhqilcQ40ysN0ABiliC9AkhjoJdv39ZWw0hf+jjQskcqFT0uh/MKy8CvQS0KXNU0ADCjXOtLcYmqLL3FXW16sMV8JWV8JmjZp2Cb3+GINRknaZf+SaSURdp1100pdKRpHWUBaRXT+ZkRC2hRJlwoCa6aLTG2J/sGoKL+QuagTiklwCOr9hrSvSKFI6Mi3mUChYxDKVRuHycA2llegllTD0FJCPnR/U0e8fottJ8PH8Frc3D7j79J3iEVfXD7j//ANn53eI60M4ZGWKasNi2RDjompAsx14YfTEUNUcAVqJe+jsJ2h1J4hbCdr9Y8z/uMX0wxWGyQKzoxuU4zFK0YDOeo+cR4ds6ohGEcJ++LyGRVFwbopFZ5gFbgdtRPUpjs4+4/D0HgmBjpIlyrUxlWUEvzKgehqQFBVW5MIsO9tdZsmwfHbe7dIxjFFtzjGcLTGaX6A3OoPmtMhkyaEI1Cvvi7oVVA1Fg4LWbwubGLLLsMDj9iHGB1+xuPkLpxc/cbL8gev7vzE//obe5A7twZKaZgqGfj3CZHbwAlBOT0pq92RHrQ8YJHdYXP+J88ufOF48inFy9AWd4RWavTPBiqXETRqOZtuAfI6FdRFTN+wg2psRy0sMpgtK+5KuhBFtNiDzmFDqacosOQatsh9u1ZAkwZeTLSyshepegrPlA04XX3F48okaMfwVpagvSDCYRZpstPY3AYW4rZJIm58OdbnaPEB3dE71OkWrf0LMpijTJsw8qA5prQad3MYNA0T7lScdrp8sHz5O7ByW1xCN+Xj1HZODK/LHEWlwKtJlYGapkH5lxYIdllAdVzcZvnQX3aLrwG8hqPTgRx0y28YqmvS9KcZsFBKx1By6V/rlJ8DnQE+MUzPgoymEv3oX9zJJzKUrIEuuZFgeMbXEXOb/jPT172v7suB6qR/mi2QMsiqM5F+o8UAx2H9AMAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5\"\n        title=\"5\"\n        src=\"/static/260be348be2337e4067d56af8b32ca3d/e4d6b/5.png\"\n        srcset=\"/static/260be348be2337e4067d56af8b32ca3d/12f09/5.png 148w,\n/static/260be348be2337e4067d56af8b32ca3d/e4a3f/5.png 295w,\n/static/260be348be2337e4067d56af8b32ca3d/e4d6b/5.png 345w\"\n        sizes=\"(max-width: 345px) 100vw, 345px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n좌측에 AWS - US East - Lambda - 생성한 람다 이름 - Upload Lambda 를 선택한다.\n그러고 다음 순서에 따라 선택한다.</p>\n<ol>\n<li>Upload Type : Directory</li>\n<li>No</li>\n<li>index.js 가 위치한 폴더 경로 - Open\n그러면 그 즉시 람다로 코드가 업로딩된다.</li>\n</ol>\n<h3 id=\"로컬-환경에서-람다로-업로드-시\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EC%BB%AC-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EB%9E%8C%EB%8B%A4%EB%A1%9C-%EC%97%85%EB%A1%9C%EB%93%9C-%EC%8B%9C\" aria-label=\"로컬 환경에서 람다로 업로드 시 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>로컬 환경에서 람다로 업로드 시</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 254px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b83453c4bb551eb3468615afd22ef60a/6a91e/6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.72972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACP0lEQVQ4y6WTa2/TMBSG9/9/DJ/4wAfQYIKtawdlXVm7la5JmzTNzXHixLnn5dhbolaahGCWHp3j5Oj1udhnAWN4C2EUIU4SJEKAkX/G4xgD9OPE/xsUp8ROBPOiwDFF7+f5CfLYl/I5tiyRppkWHgSrqkJPXdc6OAgZIh4P8FhlIYZ9IlK4XoA0y5DJnL5xiFTo8s9KOqVHCarT0DWQFHB+/gU708T19RiXlyOYhoEql9hbFsW0KGSGtiqQJK9k2AuqH3PTxa3hYbQwMX06YLKycUX+DVm1v7o3yDqYbwPc7yNsDiGyLH3OUPVBkRcl2qaGGSS4We9heSHuHje4Xa4xms4xXaxguiGMQ4Cdx7DZ+7ADEnMjXK32kEqQkaBKXdG1DdSyWIrZ1gejXr17/wGfLr5pPn7+iiAW8KJY42u4Fr9Y2sh7QSsuYcUFlHVEhZWf4ceWYeHEWAUSBq+wTRqsWYFfNsfcjl7gOmZmcdxRAkPJUQ0o/LyDL1t4Wa0zLWgo3ycTzKZT3IzHeFwu8PvhgewSk9EIW2ODftVloe+iHspP6tF4tgCTNYQSLxqInALofu1sB8bWwuN6A/vgwnF9eAGDT6WFPIEsSn0f1bUapqya+2S74CSUUhuVaJCVCNJCf1PEZYsor8GIUFbgZM1IwoszCJHAD0O6hy8lOxI45DQMUtolz9ii0VgD9ZHfwMlaLINSH6SGefJSGJ2oiKjkfyHM6GW1HcqqRESCohfEG5d6EPxYsOs6/C+vCf4BEX/A5NIvlsEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"6\"\n        title=\"6\"\n        src=\"/static/b83453c4bb551eb3468615afd22ef60a/6a91e/6.png\"\n        srcset=\"/static/b83453c4bb551eb3468615afd22ef60a/12f09/6.png 148w,\n/static/b83453c4bb551eb3468615afd22ef60a/6a91e/6.png 254w\"\n        sizes=\"(max-width: 254px) 100vw, 254px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>\n<p>코드 소스 - 에서 업로드 - .zip 파일\n을 통해서 압축한 코드를 업로드할 수 있다.\n10MB 이상 넘으면 S3 에서 업로드를 권장하지만 업로드하는데 지장이 없다.</p>\n<h2 id=\"iam-설정\" style=\"position:relative;\"><a href=\"#iam-%EC%84%A4%EC%A0%95\" aria-label=\"iam 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IAM 설정</h2>\n<p>이렇게해서 바로 실행은 할 수 가 없고 람다 IAM 권한 설정을 해야한다\nCloudFront로 요청이 들어올 때 Trigger로 Lambda@Edge가 작동되고. S3 원본에 접근하기 때문에 권한(정책)을 가지고있는 역활을 설정한다.</p>\n</li>\n<li>Lambda - 구성 - 권한 - 역활 이름 <strong>클릭</strong></li>\n<li>\n<p>권한 추가 - 정책 생성 - JSON </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n<span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"Sid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"VisualEditor0\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string\">\"iam:CreateServiceLinkedRole\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"lambda:GetFunction\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"lambda:EnableReplication\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"cloudfront:UpdateDistribution\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"s3:GetObject\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"logs:CreateLogGroup\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"logs:CreateLogStream\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"logs:PutLogEvents\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"logs:DescribeLogStreams\"</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>정책 편집을 종료하고, 역활 - 신뢰 관계 - 신뢰 정책 편집을 누른다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Principal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">\"Service\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token string\">\"edgelambda.amazonaws.com\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token string\">\"lambda.amazonaws.com\"</span>\n                <span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"sts:AssumeRole\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 설정을 통해 Lambda 함수가 기존에 가지고 있는 역활에 적절한 권한이 주어졌고 다음과 같이 볼 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/11e5a9cd0a40701ae45f8a84be5e6f67/898f6/7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.51351351351351%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVQ4y6WSa26DMBCEff+D9Bj93wtUbaNGTeJAABsMGAw2MN11Eimp6EOqpU9+yDs767U4ZQV2hwRZlmGeZ4zj+C+EaxSsPsI0Ldq2hfce4wr+jwj7/Ijy6QHHwiBNU7hhAI+FWZYILmuu4DdEWRlkuYLSGjpSoigUkiRFXhRxLeURDbmfSXSaph8RXI5SGsPoIcsezk/RH2e7OuT1X4fgup0bYG1HLktyYmOmEIjpDO+vjx5CgCfCNwjnXGwGB3330HyxtRZd10W31yRR/GtTvA+oqgo9Ca+N5TJzYqUUfa88frGC3pcFVks2xsSAtU6yEz7nKpIkiQ2SUmK/P0RRdnm+O527XDty6CZUvY+U3Xg318MUacYZrV/u4DND8beI3AZslcXmcMJGZnjdp3gjXnYJPk4aqguEh+4pYFy+ABh/j2B3dQBOtcMur/CRlXhPCmxTHfd7+vAbmUPqBjUHrYjcCdadQ2kHGCqxdlRif51voL2h86obfuUTLWLxir00iGsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"7\"\n        title=\"7\"\n        src=\"/static/11e5a9cd0a40701ae45f8a84be5e6f67/fcda8/7.png\"\n        srcset=\"/static/11e5a9cd0a40701ae45f8a84be5e6f67/12f09/7.png 148w,\n/static/11e5a9cd0a40701ae45f8a84be5e6f67/e4a3f/7.png 295w,\n/static/11e5a9cd0a40701ae45f8a84be5e6f67/fcda8/7.png 590w,\n/static/11e5a9cd0a40701ae45f8a84be5e6f67/898f6/7.png 798w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"lambdaedge-배포\" style=\"position:relative;\"><a href=\"#lambdaedge-%EB%B0%B0%ED%8F%AC\" aria-label=\"lambdaedge 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lambda@Edge 배포</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6e53c7a3fbc2c19e20c1e47c3afa1668/f73a1/8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 97.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACBUlEQVQ4y51UW27bMBDUMXu7HiJfvUEv0MQu3DR1AetBSaTeL1rTnVVYxI1R2BEwICmu9jE7q6goCuz2ezw+PmG32yNJEizLgmmabsY8zxjHEW3bIer7AU3ToW4atF2HQS4mMbjHYbCn4+j4vcHXLymMyxFnBqYs70ZuLTKptG5bRGVZ4/cxBUsfR4ki5Xrv4c9nLLLeDPnuLN9EJ3G4P/zA4XDA6RQjjmNY69TpR56IXplZ3/fKY13XQm6LYRjVYF3XuxA18nGaZsjzHIXwwQDhudVJsNUMu65HPwwbbx8sMzhTh85VMHkB65xmWJRWV54HCcTSCQal1kJgNoFUcb3IkDrMjEGaZchENroXCrgmSSrvjSKOE6GlUBUQDOCqWoNeOHRVhZMYt1I6hd1Jc8ir9+er5ZFjgg7CepmhROgkS6qdU8Izwf0o6v8Xk47ZpAmQGvbgwmEjUtlKy3QWyc88LxdE/68Z7zKshIfnny/aGJbKyMqNZKh8SUYblg38cciZ1FyTV8TL0m4dpnNyGsYojKC/Omr+urC9X6SjqWT5rJm+/DqqU/LIbOumlT/JfKsgEVnbyhxTFk5m2KLk34NTU5QqE0opSVNdeTYiJ+6N2NDWmPxVdrk2SybFi4FHXfm/kghyCHj7/j1e7+cOqxeH63r/7L7tbj+KKpoE7uET5m+f8QfX5cauLnPmiAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"8\"\n        title=\"8\"\n        src=\"/static/6e53c7a3fbc2c19e20c1e47c3afa1668/fcda8/8.png\"\n        srcset=\"/static/6e53c7a3fbc2c19e20c1e47c3afa1668/12f09/8.png 148w,\n/static/6e53c7a3fbc2c19e20c1e47c3afa1668/e4a3f/8.png 295w,\n/static/6e53c7a3fbc2c19e20c1e47c3afa1668/fcda8/8.png 590w,\n/static/6e53c7a3fbc2c19e20c1e47c3afa1668/f73a1/8.png 822w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n작업 - 기능 - Lambda@Edge 배포를 클릭한다. (리전 확인 필수)</p>\n<p>CDN은 생성한 CloudFront 로 연결하고 캐시 동작을 * 로 선택한다.\nCloudFront 이벤트는 오리진 응답으로 선택한다.</p>\n<p>그리고 최종적으로 CloudFront에 다음과 같은 <code class=\"language-text\">쿼리 문자열</code> 설정을 해야한다. 해당 설정을 하지 않고 배포한다면 CDN으로 요청 시 쿼리 문자열을 지정해도 람다가 실행되지 않는다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ab4884eb5821064687577e3807d3ef7c/61c63/9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 119.59459459459461%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVQ4y51Va3ObMBDk//+8NP2Stp4xNknKGwRIQuDr7RkIYILtamYHLEt7e0+8Uil6+/Vb8PLySj9ef1KSpOScI2MtGWNJa0PaGGoaTZb3sC6Xi2C9PMMHXdtSVdd8oaGaUZSKlKoEJb/neTEB53cJK7Yepjn5vk+n05mCIKDzOaA4jiliJEkiisMwEvKR7Lvl5ZWmj1RRmsSsIBcipdRCxSMYz3tta6lhd+Fy1/fUdR21HD88n1kjqYfAF6zoxK4mWUYxuweoqiLLsUUSlmgHWGqH2OtZXD1kEdmLOVY4MLcIlfcAo6iIL0K2BDU+EvL+IRbzohTgv2fiN5UNJJ84syD9czjIE6qxD9X2G0CZlJvWXwpxybH0sizlcs+bPScHf47ve4DbeE6EI3sUJxJHuJpxAQMwcNkgHfekEtYuaybEDyiVVpsBbm25jLLKi0JEzBMyKcQLWs4MpWDvAIRozyTNFoSicE1oHyFsHyBEtu4pbBcKS2mAXYVjKdx2xxIgxuRBDKH2hhCr4Oyeg3d2I70ScwY3MfQ56reum0XJXOuQCVFvsIxSqdn1dcM/Ohim1kM8siyXiofrmOLrybzXdjfTBiSff0PpaQCEIEfw94AQoEXNYtqgiPlyyrFbu+iGS85t4RpLeLKYNvieRGVDbwefp3XExBmFUcQhyP5vwMKCcT19hjEdj0fOdnGdNLMJ8tQnwAzB7zonk3jL6jPrH5ipWBz+s6pdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9\"\n        title=\"9\"\n        src=\"/static/ab4884eb5821064687577e3807d3ef7c/fcda8/9.png\"\n        srcset=\"/static/ab4884eb5821064687577e3807d3ef7c/12f09/9.png 148w,\n/static/ab4884eb5821064687577e3807d3ef7c/e4a3f/9.png 295w,\n/static/ab4884eb5821064687577e3807d3ef7c/fcda8/9.png 590w,\n/static/ab4884eb5821064687577e3807d3ef7c/61c63/9.png 693w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>이로써 이미지 리사이징 적용이 끝났다. CloudFront에 람다가 배포된 후 CDN URI를 통해서 가져올 이미지의 Key 를 지정한뒤 쿼리 문자열을 지정하여 리사이징을 호출한다.</p>\n<h2 id=\"웹-성능-개선\" style=\"position:relative;\"><a href=\"#%EC%9B%B9-%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0\" aria-label=\"웹 성능 개선 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>웹 성능 개선</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2824b8d9d8da607e3d0062f2a86655e1/31aff/10.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.945945945945947%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAy0lEQVQY012Qyw6CMBBF+f8/cWNc+QFq0KVbWPCytECB8ljw5tqZaGJcTNqZuff0pk6WZajrGsYYdF2HpmkwzzPWdeXa9x1t26IoCmzbxtppmjAMA+vIU1UV99enC0cIAc/zuOI4hlIKfd9jWRY20qm1RhiGDHhZPZlpPo4jyB9FEZSUONyOcJIkge/7XHSXdkGvfoGUMs9zBEHAM/EBEpyBaYo4sj4lcXLPcFILIDElSO2SvuA/YVmWDCII7X+BphSodYhOC1wed7wBKgcs64EMYFIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"10\"\n        title=\"10\"\n        src=\"/static/2824b8d9d8da607e3d0062f2a86655e1/fcda8/10.png\"\n        srcset=\"/static/2824b8d9d8da607e3d0062f2a86655e1/12f09/10.png 148w,\n/static/2824b8d9d8da607e3d0062f2a86655e1/e4a3f/10.png 295w,\n/static/2824b8d9d8da607e3d0062f2a86655e1/fcda8/10.png 590w,\n/static/2824b8d9d8da607e3d0062f2a86655e1/31aff/10.png 823w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>CDN으로 부터 이미지 리사이징된 리소스들을 받아온 모습이다. 원본 리소스를 조회했을 때 보다 매우 빠르게 작동한다.</p>\n<h3 id=\"원본-리소스-크기\" style=\"position:relative;\"><a href=\"#%EC%9B%90%EB%B3%B8-%EB%A6%AC%EC%86%8C%EC%8A%A4-%ED%81%AC%EA%B8%B0\" aria-label=\"원본 리소스 크기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>원본 리소스 크기</h3>\n<p>원본 이미지의 사이즈가 1200x750 일때 다음과 같이 받아온다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4adadb6c4851644e40010b84d8670802/43142/11.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.08108108108108%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA30lEQVQY02VQ26qDQAz0//9NKgqC9VJEH7y1erxbXadO2pWWExh3N5nMJBpKKWwH1Afbtp13Yt/3E7+1/3neDX4Y4ziiKAp0XSdvEhh936OqKtR1LW/NX5ZFuNM0QYcI6uayLBGGIUzTRBAE5yRZlsGyLHieB9u2Rej+aHD1wyN/kTzrNGYYWpluURTBcRzEcSxi67qKkeu6Ikyj55OCf4huMQLfF65/nMMwvAW/V+ZanECbULRtWyRJgjzPv1ZTmOcZTdMgTdOfnlNQ/1hd0OCUNONK5Ly5SkQI5lnXfS8Jxs8KlmE1HwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"11\"\n        title=\"11\"\n        src=\"/static/4adadb6c4851644e40010b84d8670802/fcda8/11.png\"\n        srcset=\"/static/4adadb6c4851644e40010b84d8670802/12f09/11.png 148w,\n/static/4adadb6c4851644e40010b84d8670802/e4a3f/11.png 295w,\n/static/4adadb6c4851644e40010b84d8670802/fcda8/11.png 590w,\n/static/4adadb6c4851644e40010b84d8670802/43142/11.png 599w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"캐싱-리소스-크기\" style=\"position:relative;\"><a href=\"#%EC%BA%90%EC%8B%B1-%EB%A6%AC%EC%86%8C%EC%8A%A4-%ED%81%AC%EA%B8%B0\" aria-label=\"캐싱 리소스 크기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>캐싱 리소스 크기</h3>\n<p>이미지 리사이즈를 통해 640x640 이고 퀄리티를 75, 포맷을 webp 로 했을떄 다음과 같다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 527px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fc758aad84105862744eaa5ec18f6dff/44385/12.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVQoz31R24qDMBDN/39OQej7Pq2UiggF3xTayuK9YuItns0MjKul7EDQuZzLJMpMFoMx0FpjHEes6wpr7b8HsGiNxUvPGAcD4/DTNDFe9YN1BY2+11ykIFI5EiIkX1fBPmReYXUOh2FT+QMA8zw7oZ7di9i+Z8zAruhfSBUlz+cTaZqiqqoDiITu9zsejwfatj30tBPKsowxJLgRLsvC7sIwxPl8ZkUKqtNgFEW4Xq/wPA9BEHCvdCRf/jculwt838fpdEIcx9xTxEpO8jw/OJR60zQoigJd13FOQev/FDm7ruuar0XWVgQmorIs2dV+LRqk67jdbgexZV7QvToWSpKEV6ctN4dCsH+tDexEyJE8mMxTTj1yRs7FjPpEJPl7fKq9938BuEa7T/nSB0IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"12\"\n        title=\"12\"\n        src=\"/static/fc758aad84105862744eaa5ec18f6dff/44385/12.png\"\n        srcset=\"/static/fc758aad84105862744eaa5ec18f6dff/12f09/12.png 148w,\n/static/fc758aad84105862744eaa5ec18f6dff/e4a3f/12.png 295w,\n/static/fc758aad84105862744eaa5ec18f6dff/44385/12.png 527w\"\n        sizes=\"(max-width: 527px) 100vw, 527px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n기존 리소스 크기가 약 290KB 일때 이미지 리사이즈를 통해서 약 22KB로 약  1/13정도로 크기가 줄어 든 것을 볼 수 있다.</p>\n<h2 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>이미지 리사이징을 통해서 원본 이미지를 그대로 받아오는 것 보다 스토리지 비용이 상대적으로 감소하고 또한 네트워크 전송량에 따른 비용도 감소한다. 새로운 해상도나 모바일 환경에 맞춰서 해상도 대응 문제를 해결하기 쉽다. 최종적으로 많은 이미지를 그려도 적은 용량으로 브라우저에서 로딩하기 떄문에 사용자 경험도 매우 좋게 상승한다.</p>\n<h2 id=\"레퍼런스\" style=\"position:relative;\"><a href=\"#%EB%A0%88%ED%8D%BC%EB%9F%B0%EC%8A%A4\" aria-label=\"레퍼런스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>레퍼런스</h2>\n<p><a href=\"https://lemontia.tistory.com/1071\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://lemontia.tistory.com/1071</a></p>\n<p><a href=\"https://heropy.blog/2019/07/21/resizing-images-cloudfrount-lambda/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://heropy.blog/2019/07/21/resizing-images-cloudfrount-lambda/</a></p>\n<p><a href=\"https://tech.wired.company/cloudfront%EC%99%80-aws-lambda-edge%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%9C-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94-dab488c0ef35\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://tech.wired.company/cloudfront와-aws-lambda-edge를-활용한-이미지-최적화-dab488c0ef35</a></p>\n<p><a href=\"https://velog.io/@dankim/Lambdaedge-cloudFront-S3\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://velog.io/@dankim/Lambdaedge-cloudFront-S3</a></p>\n<p><a href=\"https://velog.io/@su-mmer/CloudFront%EC%99%80-LambdaEdge%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%A6%AC%EC%82%AC%EC%9D%B4%EC%A7%95\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://velog.io/@su-mmer/CloudFront와-LambdaEdge를-이용한-이미지-리사이징</a></p>\n<p><a href=\"https://medium.com/daangn/lambda-edge%EB%A1%9C-%EA%B5%AC%ED%98%84%ED%95%98%EB%8A%94-on-the-fly-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%A6%AC%EC%82%AC%EC%9D%B4%EC%A7%95-f4e5052d49f3\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://medium.com/daangn/lambda-edge로-구현하는-on-the-fly-이미지-리사이징-f4e5052d49f3</a></p>","excerpt":"AWS - S3 리소스를 CloudFront로 캐싱하자 이어서 S3 이미지 리사이징 동작 순서 클라이언트에서  요청을 보냄. CDN에서 w, h, f, q 쿼리 파라미터가 붙어있으면  해당 S3 Object(이미지)가 CDN에 캐싱이 되어있으면 해당…","tableOfContents":"<ul>\n<li><a href=\"/aws-s3-image-resize/#s3-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%A6%AC%EC%82%AC%EC%9D%B4%EC%A7%95-%EB%8F%99%EC%9E%91-%EC%88%9C%EC%84%9C\">S3 이미지 리사이징 동작 순서</a></li>\n<li><a href=\"/aws-s3-image-resize/#aws-cloud9-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1-%EC%8B%9C\">AWS Cloud9 환경에서 코드 작성 시</a></li>\n<li>\n<p><a href=\"/aws-s3-image-resize/#%EB%A1%9C%EC%BB%AC-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1-%EC%8B%9C\">로컬 환경에서 코드 작성 시</a></p>\n<ul>\n<li><a href=\"/aws-s3-image-resize/#%EB%B9%8C%EB%93%9C-%ED%99%98%EA%B2%BD%EC%9D%B4-x86_64-%EC%83%9D%EC%84%B1%ED%95%9C-%EB%9E%8C%EB%8B%A4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98%EC%9D%B4-%EC%95%84%EB%8B%90-%EA%B2%BD%EC%9A%B0\">빌드 환경이 x86_64 (생성한 람다 아키텍처)이 아닐 경우</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/aws-s3-image-resize/#lambda-%EC%83%9D%EC%84%B1\">Lambda 생성</a></p>\n<ul>\n<li><a href=\"/aws-s3-image-resize/#%EC%BD%94%EB%93%9C-%EC%97%85%EB%A1%9C%EB%93%9C\">코드 업로드</a></li>\n<li><a href=\"/aws-s3-image-resize/#cloud9%EC%97%90%EC%84%9C-%EB%9E%8C%EB%8B%A4%EB%A1%9C-%EC%97%85%EB%A1%9C%EB%93%9C-%EC%8B%9C\">Cloud9에서 람다로 업로드 시</a></li>\n<li><a href=\"/aws-s3-image-resize/#%EB%A1%9C%EC%BB%AC-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EB%9E%8C%EB%8B%A4%EB%A1%9C-%EC%97%85%EB%A1%9C%EB%93%9C-%EC%8B%9C\">로컬 환경에서 람다로 업로드 시</a></li>\n</ul>\n</li>\n<li><a href=\"/aws-s3-image-resize/#lambdaedge-%EB%B0%B0%ED%8F%AC\">Lambda@Edge 배포</a></li>\n<li>\n<p><a href=\"/aws-s3-image-resize/#%EC%9B%B9-%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0\">웹 성능 개선</a></p>\n<ul>\n<li><a href=\"/aws-s3-image-resize/#%EC%9B%90%EB%B3%B8-%EB%A6%AC%EC%86%8C%EC%8A%A4-%ED%81%AC%EA%B8%B0\">원본 리소스 크기</a></li>\n<li><a href=\"/aws-s3-image-resize/#%EC%BA%90%EC%8B%B1-%EB%A6%AC%EC%86%8C%EC%8A%A4-%ED%81%AC%EA%B8%B0\">캐싱 리소스 크기</a></li>\n</ul>\n</li>\n<li><a href=\"/aws-s3-image-resize/#%EA%B2%B0%EB%A1%A0\">결론</a></li>\n<li><a href=\"/aws-s3-image-resize/#%EB%A0%88%ED%8D%BC%EB%9F%B0%EC%8A%A4\">레퍼런스</a></li>\n</ul>","fields":{"slug":"/aws-s3-image-resize/"},"frontmatter":{"title":"[AWS] Lambda@Edge를 통해 이미지 리사이징을 해서 웹 성능 개선을 해보자","date":"Apr 12, 2023","tags":["AWS","Cache","S3","CloudFront","Lambda"],"keywords":["AWS","Cache","S3","CloudFront","Lambda"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/aws-s3-image-resize/","series":[],"lastmod":"2023-04-12"}},"staticQueryHashes":["2027115977","694178885"]}