{"componentChunkName":"component---src-templates-post-tsx","path":"/springboot-jwt-tutorial5/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"1-회원가입-api-작성\" style=\"position:relative;\"><a href=\"#1-%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85-api-%EC%9E%91%EC%84%B1\" aria-label=\"1 회원가입 api 작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 회원가입 API 작성</h1>\n<h2 id=\"securityutil-클래스\" style=\"position:relative;\"><a href=\"#securityutil-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"securityutil 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecurityUtil 클래스</h2>\n<p>간단한 유틸리티 메소드를 만들기 위해 <code class=\"language-text\">SecurityUtil</code> 클래스를 util 패키지에 생성하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityUtil</span> <span class=\"token punctuation\">{</span>\n\n   <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Logger</span> logger <span class=\"token operator\">=</span> <span class=\"token class-name\">LoggerFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SecurityUtil</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n   <span class=\"token keyword\">private</span> <span class=\"token class-name\">SecurityUtil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token punctuation\">}</span>\n\n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getCurrentUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">final</span> <span class=\"token class-name\">Authentication</span> authentication <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>authentication <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Security Context에 인증 정보가 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token class-name\">String</span> username <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">UserDetails</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token class-name\">UserDetails</span> springSecurityUser <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDetails</span><span class=\"token punctuation\">)</span> authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         username <span class=\"token operator\">=</span> springSecurityUser<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         username <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> authentication<span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token class-name\">Optional</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofNullable</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">getCurrentUsername</code> 메소드의 역활은 SecurityContext의 Authentication 객체를 이용해 <code class=\"language-text\">username</code>을 리턴해주는 간단한 유틸성 메소드입니다. </p>\n<p><code class=\"language-text\">SecurityContext</code>에 Authenticaion 객체가 저장되는 시점은 JwtFilter의 <code class=\"language-text\">doFilter</code>메소드에서 Request가 들어올때 SecurityContext에 Authenticaion 객체를 저장해서 사용하게 됩니다.</p>\n<h2 id=\"userservice-클래스\" style=\"position:relative;\"><a href=\"#userservice-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"userservice 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserService 클래스</h2>\n<p>회원가입, 유저 정보 조회등의 메소드를 만들기 위해 UserService 클래스를 생성하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PasswordEncoder</span> passwordEncoder<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">,</span> <span class=\"token class-name\">PasswordEncoder</span> passwordEncoder<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>userRepository <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>passwordEncoder <span class=\"token operator\">=</span> passwordEncoder<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">signup</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDto</span> userDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findOneWithAuthoritiesByUsername</span><span class=\"token punctuation\">(</span>userDto<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"이미 가입되어 있는 유저입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">Authority</span> authority <span class=\"token operator\">=</span> <span class=\"token class-name\">Authority</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">authorityName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_USER\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">username</span><span class=\"token punctuation\">(</span>userDto<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span>passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>userDto<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">nickname</span><span class=\"token punctuation\">(</span>userDto<span class=\"token punctuation\">.</span><span class=\"token function\">getNickname</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">authorities</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">singleton</span><span class=\"token punctuation\">(</span>authority<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">activated</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>readOnly <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserWithAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findOneWithAuthoritiesByUsername</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>readOnly <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getMyUserWithAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">SecurityUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span>userRepository<span class=\"token operator\">::</span><span class=\"token function\">findOneWithAuthoritiesByUsername</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>UserService 클래스는 <code class=\"language-text\">UserRepository</code>, <code class=\"language-text\">PasswordEncoder</code>를 주입받습니다.</p>\n<p><code class=\"language-text\">singup</code> 메소드는 username이 DB에 존재하지 않으면 Authority와 User 정보를 생성해서 UserRepository의 <code class=\"language-text\">save</code>메소드를 통해 DB에 정보를 저장합니다. </p>\n<p>여기서 <strong>중요한 점</strong>은 <code class=\"language-text\">singup</code> 메소드를 통해 가입한 회원은 USER ROLE을 가지고 있고 <code class=\"language-text\">data.sql</code> 에서 자동 생성되는 admin 계정은 USER, ADMIN ROLE을 가지고 있습니다 이 차이를 통해 권한검증 부분을 테스트 하겠습니다.</p>\n<p>그리고 유저 권한정보를 가져오는 메소드가 2개 있습니다.</p>\n<p><code class=\"language-text\">getUserWithAuthorities</code>는 username을 기준으로 정보를 가져오고</p>\n<p><code class=\"language-text\">getMyUserWithAuthorities</code>는 SecurityContext에 저장된 username의 정보만 가져옵니다.</p>\n<p>이 두가지 메소드의 허용권한을 다르게 해서 권한검증에 대한 부분을 테스트하겠습니다.</p>\n<h1 id=\"2-권한-검증\" style=\"position:relative;\"><a href=\"#2-%EA%B6%8C%ED%95%9C-%EA%B2%80%EC%A6%9D\" aria-label=\"2 권한 검증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 권한 검증</h1>\n<h2 id=\"usercontroller-클래스\" style=\"position:relative;\"><a href=\"#usercontroller-%ED%81%B4%EB%9E%98%EC%8A%A4\" aria-label=\"usercontroller 클래스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserController 클래스</h2>\n<p><code class=\"language-text\">UserService</code>의 메소드들을 호출할 <code class=\"language-text\">UserController</code> 클래스를 생성하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">UserService</span> userService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserController</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserService</span> userService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>userService <span class=\"token operator\">=</span> userService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/signup\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">signup</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Valid</span> <span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">UserDto</span> userDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>userService<span class=\"token punctuation\">.</span><span class=\"token function\">signup</span><span class=\"token punctuation\">(</span>userDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasAnyRole('USER','ADMIN')\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getMyUserInfo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>userService<span class=\"token punctuation\">.</span><span class=\"token function\">getMyUserWithAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/{username}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasAnyRole('ADMIN')\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserInfo</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>userService<span class=\"token punctuation\">.</span><span class=\"token function\">getUserWithAuthorities</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">@PreAuthorize</code></p>\n<ul>\n<li>해당 메서드가 호출되기 이전에 권한을 검사한다</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">hasAnyRole([role1, role2])</code></p>\n<ul>\n<li>현재 사용자의 권한이 파라미터의 권한 중 일치하는 것이 있는 경우 <code class=\"language-text\">true</code> 를 리턴</li>\n</ul>\n</li>\n</ul>\n<p><code class=\"language-text\">sinup</code> 메소드는 UserDto를 매개변수로 받아서 UserService의 <code class=\"language-text\">singup</code> 메소드를 호출합니다.</p>\n<p><code class=\"language-text\">getMyUserInfo</code> 메소드는 <code class=\"language-text\">@PreAuthorize</code>를 통해서 USER, ADMIN 두가지 권한 모두 허용했고</p>\n<p><code class=\"language-text\">getUserInfo</code> 메소드는 ADMIN 권한만 호출할 수 있도록 설정했습니다 그리고 <code class=\"language-text\">UserService</code>에서 만들었던 username 매개변수를 기준으로 유저 정보와 권한 정보를 리턴하는 API가 되겠습니다. </p>\n<h1 id=\"3-response-시-dto를-통해서만-받기\" style=\"position:relative;\"><a href=\"#3-response-%EC%8B%9C-dto%EB%A5%BC-%ED%86%B5%ED%95%B4%EC%84%9C%EB%A7%8C-%EB%B0%9B%EA%B8%B0\" aria-label=\"3 response 시 dto를 통해서만 받기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Response 시 DTO를 통해서만 받기</h1>\n<h2 id=\"기존-문제점\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EC%A1%B4-%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"기존 문제점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기존 문제점</h2>\n<p>추가적으로 지금까지 로직을 보시면 사용자 요청에 대해 응답을 Entity 그대로 전달하기 때문에 문제가있습니다.  문제점을 보기위해 Entity를 통해 반환을 하게 되면 어떤 결과를 나오는지 보겠습니다.</p>\n<ul>\n<li>Response - <code class=\"language-text\">POST</code> /api/signup</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"userId\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hoon\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"password\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"$2a$10$PZhLrJzS9YQX1.M5.ezMhu/VFAbtSiYLU.ExF3qzlBrrk7bHPyzdm\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"nickname\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nick\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"activated\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"authorities\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"authorityName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ROLE_USER\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>해당 응답 결과처럼, 보시면은 중요한 정보들이 그대로 반환이 됩니다 그 이유는 <code class=\"language-text\">UserService</code>의 회원가입 로직을 처리하는 메소드가 User Entity 그대로 반환해주기 때문에 사용자 측에서는 해당 결과를 받게됩니다.</p>\n<p>보안적인 측면에서도 안좋은 방식이므로 DTO를 통해 응답하도록 코드를 수정하겠습니다.</p>\n<h2 id=\"해결법\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0%EB%B2%95\" aria-label=\"해결법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결법</h2>\n<h3 id=\"authoritydto-클래스-생성\" style=\"position:relative;\"><a href=\"#authoritydto-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%83%9D%EC%84%B1\" aria-label=\"authoritydto 클래스 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AuthorityDto 클래스 생성</h3>\n<p>권한정보에 대한 DTO 클래스를 작성하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Setter</span>\n<span class=\"token annotation punctuation\">@Builder</span>\n<span class=\"token annotation punctuation\">@AllArgsConstructor</span>\n<span class=\"token annotation punctuation\">@NoArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthorityDto</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> authorityName<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"userdto-클래스-수정\" style=\"position:relative;\"><a href=\"#userdto-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%88%98%EC%A0%95\" aria-label=\"userdto 클래스 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserDto 클래스 수정</h3>\n<p>아래와 같이 권한 정보에 대한 <code class=\"language-text\">authorityDtoSet</code> 필드를 추가하고 <code class=\"language-text\">from</code> 메소드를 추가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AuthorityDto</span><span class=\"token punctuation\">></span></span> authorityDtoSet<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">UserDto</span> <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>user <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">UserDto</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">username</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">nickname</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getNickname</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">authorityDtoSet</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>authority <span class=\"token operator\">-></span> <span class=\"token class-name\">AuthorityDto</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authorityName</span><span class=\"token punctuation\">(</span>authority<span class=\"token punctuation\">.</span><span class=\"token function\">getAuthorityName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">from</code> 메소드는 <code class=\"language-text\">User</code> 객체를 매개변수로 받아서 해당 객체가 <code class=\"language-text\">null</code>이 아니면, 해당 객체를 <code class=\"language-text\">UserDto</code>로 생성해서 반환합니다.</p>\n<h3 id=\"userservice-클래스-수정\" style=\"position:relative;\"><a href=\"#userservice-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%88%98%EC%A0%95\" aria-label=\"userservice 클래스 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserService 클래스 수정</h3>\n<p><code class=\"language-text\">User</code>로 반환하던 이전 메소드들을 <code class=\"language-text\">UserDto</code>로 반환하도록 수정하겠습니다. (굵은 글씨를 봐주세요)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token class-name\">UserDto</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span> <span class=\"token function\">signup</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserDto</span> userDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findOneWithAuthoritiesByUsername</span><span class=\"token punctuation\">(</span>userDto<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"이미 가입되어 있는 유저입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token class-name\">Authority</span> authority <span class=\"token operator\">=</span> <span class=\"token class-name\">Authority</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">authorityName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_USER\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">username</span><span class=\"token punctuation\">(</span>userDto<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">password</span><span class=\"token punctuation\">(</span>passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>userDto<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">nickname</span><span class=\"token punctuation\">(</span>userDto<span class=\"token punctuation\">.</span><span class=\"token function\">getNickname</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">authorities</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">singleton</span><span class=\"token punctuation\">(</span>authority<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">activated</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token class-name\">UserDto</span><span class=\"token punctuation\">.</span>from<span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>readOnly <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token class-name\">UserDto</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span> <span class=\"token function\">getUserWithAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token class-name\">UserDto</span><span class=\"token punctuation\">.</span>from<span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findOneWithAuthoritiesByUsername</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>readOnly <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token class-name\">UserDto</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span> <span class=\"token function\">getMyUserWithAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token class-name\">UserDto</span><span class=\"token punctuation\">.</span>from<span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SecurityUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span>userRepository<span class=\"token operator\">::</span><span class=\"token function\">findOneWithAuthoritiesByUsername</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>회원가입 로직을 처리하는 <code class=\"language-text\">signup</code> 메소드는 기존 소스 그대로에서 <code class=\"language-text\">UserDto.from</code> 을 통해 <code class=\"language-text\">User</code>를 Dto로 생성해서 반환합니다.</p>\n<p>나머지 두개의 권한 정보을 반환하는 메소드도 <code class=\"language-text\">UserDto</code>로 반환하도록 수정합니다.</p>\n<p>기존에는 <code class=\"language-text\">Optional</code>을 통해서 <code class=\"language-text\">null</code> 예외처리를 해줬지만, 이젠 <code class=\"language-text\">null</code> 값이 들어오면 해당 값 그대로 리턴합니다.</p>\n<h3 id=\"usercontroller-클래스-수정\" style=\"position:relative;\"><a href=\"#usercontroller-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%88%98%EC%A0%95\" aria-label=\"usercontroller 클래스 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UserController 클래스 수정</h3>\n<p>요청에 대해 <code class=\"language-text\">User</code>로 반환하던 이전 메소드들을 <code class=\"language-text\">UserDto</code>로 반환하도록 수정하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/signup\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token class-name\">UserDto</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">></span> <span class=\"token function\">signup</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Valid</span> <span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">UserDto</span> userDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>userService<span class=\"token punctuation\">.</span><span class=\"token function\">signup</span><span class=\"token punctuation\">(</span>userDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasAnyRole('USER','ADMIN')\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token class-name\">UserDto</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">></span> <span class=\"token function\">getMyUserInfo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>userService<span class=\"token punctuation\">.</span><span class=\"token function\">getMyUserWithAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/{username}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@PreAuthorize</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hasAnyRole('ADMIN')\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token class-name\">UserDto</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">></span> <span class=\"token function\">getUserInfo</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@PathVariable</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span>userService<span class=\"token punctuation\">.</span><span class=\"token function\">getUserWithAuthorities</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>기존과 비슷하게 반환하는 객체를 <code class=\"language-text\">UserDto</code>로 변경해줍니다.</p>\n<p>API 요청에 대해 <code class=\"language-text\">Entity</code>을 반환하는것이 아닌 <code class=\"language-text\">Dto</code>를 반환하는 코드로 변경을 완료했습니다.</p>\n<h1 id=\"4-회원가입-api-테스트\" style=\"position:relative;\"><a href=\"#4-%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85-api-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"4 회원가입 api 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 회원가입 API 테스트</h1>\n<p>이제 우리가 만든 3개의 API를 Postman, H2 Console를 이용해 테스트해보겠습니다.</p>\n<h2 id=\"회원가입-요청\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85-%EC%9A%94%EC%B2%AD\" aria-label=\"회원가입 요청 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회원가입 요청</h2>\n<p>URL : <a href=\"http://localhost:8080/api/signup\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:8080/api/signup</a> 경로로 <code class=\"language-text\">POST</code> 요청을 보냅니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7f1a4f214ba08ef4ed74cb7805657dc6/1628f/5-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/UlEQVQoz6VQ0XKEIAzk/7/yXlpPUQERiQJuk9wxfeu0U2YWQtgky5pxHGGtRUoJMUaNJScYhkEh8RaCcvZ9/xFmWRY453AcB7Ztg9zXddXGdraY5xnPaUKIGxIXyFBBb/49JGkPc54nSim4rksTcr/vGzln5Mpxa/DTB6hm5hRtILxaq3Ibv8udiCDL6ASeKEnvvaqUOPAXBd47uGVGCh47x5kL5UfdokXe8oVnYFG1wYi6xA1EUVfaz47znSt8irLO6TzNlYbKao1IJk0WnKyI7IQUd9hASvjrMlKU6OXjwebHxwPRBXyuL5+AWz39LUzjjdhcoqwGS5P/4As41G6Xal0S7wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/7f1a4f214ba08ef4ed74cb7805657dc6/fcda8/5-1.png\"\n        srcset=\"/static/7f1a4f214ba08ef4ed74cb7805657dc6/12f09/5-1.png 148w,\n/static/7f1a4f214ba08ef4ed74cb7805657dc6/e4a3f/5-1.png 295w,\n/static/7f1a4f214ba08ef4ed74cb7805657dc6/fcda8/5-1.png 590w,\n/static/7f1a4f214ba08ef4ed74cb7805657dc6/efc66/5-1.png 885w,\n/static/7f1a4f214ba08ef4ed74cb7805657dc6/c83ae/5-1.png 1180w,\n/static/7f1a4f214ba08ef4ed74cb7805657dc6/1628f/5-1.png 1232w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>\n<p>Response</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hoon\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"nickname\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nick\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"authorityDtoSet\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"authorityName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ROLE_USER\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<p>회원가입 API에 대한 응답이 정상적으로 반환됬습니다 이제 가입된 유저정보를 H2 Console 에서 확인해보겠습니다.</p>\n<h3 id=\"h2-console\" style=\"position:relative;\"><a href=\"#h2-console\" aria-label=\"h2 console permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>H2 Console</h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/55d37b712f4bca6ccf91d25f7efd84c0/e9131/5-2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 152.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEIUlEQVRIx8VWaXPiRhTU//8r2Q9bqfKuN1nf5jYgQOgAJMRhbgkLCRBnp2eEndTG9jrJh1DVnpk3Q0/Pm9eDlUajgVwuB9u2YRiGhKZpHLewXq8RRZHEcrn8EBTP8zCZTLBaLeUXgyCAiIVhiH/zUcaTMfr9viQdjUaynU6nknQwGEjlnU4HcRzLLxyPx3ehdLtd6LoO3/cl2ePjIxzHQa/Xk0TtdluOP0y42+0+fJyfkUlCkfgfg4fD4W/4CJkk/OhR/n9CjsSf/wzmMGaOjtjvDy+twO40/qdQVpGHeOlhTYTB5NSfIV75crx4GrNNIPrPeC0moPgTG3fXn1DMn8G2UshnvkBTL5G++4zAM7BZ2oiebCwDWjEkFi3EUYvjJBaHp/gJypPv4uZSxe/fNDzkdJQeyigXq7i/1ZC+t3B/04Re01EpGxw7KOSaXN9CTTVQr5pI3bWRTTvICWRsEnodaNUe9PoUDWuIbmcItWyiXGqiqnZR18Zw231otRbSqRYqjJVLYzh2n3Mm7m6bJDWQ4uZ5bqbMvS5Wy/nploRrDrQbySpF+nl08kgS07QSZrOhHAs0LJ6olEGhkEaxmIFlaXxtpi6GwwG22618rrabDSdMLiwxPsSO8c0mJqGNer2ODcssWRfzqdOpKo9UKiXX1zVBOGnzlRlKHcLXojgbDcrPF+QrJD77/Y6EDkzTlGsEhB01rYZMRigsUGERtVoNymzsoOM2sQh8wkPwNONRNB65hNGwR0UR4vWCObNgmRrWq4VEvA7luuJDlspUmaKK+gBlOhI3dsNbOodRS6FSukaViKM+VosOFr4jsQ67MraYOwjnz7EetqsBS6tPPMq+slwM5IJw7rLeEiz8NmvQlm04TyD6csz58LQuiTunuWQTZRUOqaTLIu2SJNl1teix7ctWxJ/nxaYvZG+Al+Lg+uIXFLJnaFlpZO7PoBa/s/0VhnbDIv5EJ31mcd/wSG3pGqHoLVIloFOuLjR8PTNZ6SyXQoVuqeP22sBv53VcfW9yM4s51nH+pYV81uBJLBJ2knT8SDifdXhbfd60R0wxeBzztnTenM1b7dE1FlGDobtotXz0ukM8efYph68oFE6JovmLI47HHQubhPUqXLfFWqsgm03zB2yQrDhsEfg9ErZfP7JQOJtOTg5Y0YYRC7QCVS1TUZMF+yARhqy9eM0f8wjC/5LwNYU+rTeZjKRDhAO228R6wmau2yZ5lSlQudGS6vbShoHffVuh8PKY1tvv95JMqDDpUdM0SOjylalJSy35X4WwoJh/l1AqHA/la7Pfb6lyQzIdtWoFzaZF0xd55AIJQzn/U8LRoMFSuWLdfYNWSfHlvuRDe8E80S3+M9y/gK6Yv1OHUdCHP2nAGxNsRX82smSNPVtRqPmz/75T/gDdQBOavpcNYwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"5 2\" title=\"5 2\" src=\"/static/55d37b712f4bca6ccf91d25f7efd84c0/fcda8/5-2.png\" srcset=\"/static/55d37b712f4bca6ccf91d25f7efd84c0/12f09/5-2.png 148w,\n/static/55d37b712f4bca6ccf91d25f7efd84c0/e4a3f/5-2.png 295w,\n/static/55d37b712f4bca6ccf91d25f7efd84c0/fcda8/5-2.png 590w,\n/static/55d37b712f4bca6ccf91d25f7efd84c0/e9131/5-2.png 614w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<p>추가한 유저 정보가 잘 등록된것을 볼수있습니다.</p>\n<p>이제 권한이 다른 두 계정(admin, uesr)을 가지고 두 개의 API를 테스트해보겠습니다.</p>\n<h2 id=\"권한-api-테스트\" style=\"position:relative;\"><a href=\"#%EA%B6%8C%ED%95%9C-api-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"권한 api 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>권한 API 테스트</h2>\n<p>먼저 ADMIN 권한만 허용했던 API를 테스트하겠습니다.</p>\n<p>URL : <a href=\"http://localhost:8080/api/user/hoon\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:8080/api/user/hoon</a> 경로로 GET 요청을 합니다.</p>\n<ul>\n<li>\n<p>Response - <code class=\"language-text\">GET</code> /api/user/hoon</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 406px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/86a0a07a7985a3b5b33855493bff2fc7/e33ef/5-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.351351351351354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAArklEQVQY06VQWwrCMBDs/e/VA4hIUVt8oa2pqX3YpNZsxmQlWgS/XBiysxkmk42stQjwNeUeRATjQJa4D/jWhFkUiDEGwzC8LsgyN2Tws9z7rDEfje+jkExKiTiOQQ+DTO6xKNbYVkeklx3m+ZJ5ck6xKjeYnRIUbYl+VG6WseZQ5xzgbejTCSE4nR4H9HfFZ61biE6iUjWuqmF4MzVqXsPN6RrdMfjL0/39W97nCf9yhhwlpz0FAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/86a0a07a7985a3b5b33855493bff2fc7/e33ef/5-3.png\"\n        srcset=\"/static/86a0a07a7985a3b5b33855493bff2fc7/12f09/5-3.png 148w,\n/static/86a0a07a7985a3b5b33855493bff2fc7/e4a3f/5-3.png 295w,\n/static/86a0a07a7985a3b5b33855493bff2fc7/e33ef/5-3.png 406w\"\n        sizes=\"(max-width: 406px) 100vw, 406px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n</li>\n</ul>\n<p>401 상태가 반환된것을 볼수있습니다.</p>\n<h3 id=\"jwt-token-가져오기\" style=\"position:relative;\"><a href=\"#jwt-token-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\"jwt token 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWT Token 가져오기</h3>\n<p>ADMIN 계정을 로그인해서 token을 가져오겠습니다,</p>\n<p>URL : <a href=\"http://localhost:8080/api/authenticate\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:8080/api/authenticate</a> 경로에 POST 요청을 보냅니다.</p>\n<ul>\n<li>\n<p>Response - <code class=\"language-text\">POST</code> /api/authenticate</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"token\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImF1dGgiOiJST0xFX0FETUlOLFJPTEVfVVNFUiIsImV4cCI6MTY0MjE2NTU3N30.UyNbN-cX82pIRHOMKWTjnDSTLX-TWzER3otxNaKKTxeB9egSL2gp8FMzr5wznIFRXEyBdU-1cFMcKnQerBjiGg\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<p>그리고 해당 어드민 유저의 토큰을 HTTP Headers에 <code class=\"language-text\">Authorization : Bearer {jwt_token}</code> 형식으로 담고 다시 권한 API 경로로 GET 요청을 보냅니다.</p>\n<h3 id=\"admin-권한-테스트\" style=\"position:relative;\"><a href=\"#admin-%EA%B6%8C%ED%95%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"admin 권한 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ADMIN 권한 테스트</h3>\n<ul>\n<li>\n<p>Response - <code class=\"language-text\">GET</code> /api/user/hoon</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hoon\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"nickname\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nick\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"authorityDtoSet\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"authorityName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ROLE_USER\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<p>/api/user/hoon 경로는 <code class=\"language-text\">ROLE_ADMIN</code> 권한을 가진 유저만 접근할 수 있는데. 정상적으로 응답이 된것을 확인할수있습니다.</p>\n<h3 id=\"user-권한-테스트\" style=\"position:relative;\"><a href=\"#user-%EA%B6%8C%ED%95%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"user 권한 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>USER 권한 테스트</h3>\n<p>이번에는 hoon 계정의 토큰으로 이 API를 재호출 해보도록 하겠습니다.</p>\n<p>기존에 로그인 API를 hoon 계정으로 요청하고, 토큰을 발급받습니다.</p>\n<ul>\n<li>\n<p>Response - <code class=\"language-text\">POST</code> /api/authenticate</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"token\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJob29uIiwiYXV0aCI6IlJPTEVfVVNFUiIsImV4cCI6MTY0MjE2NjA1N30.UMN19s9OGrX10qcO6tgET91rggoatwtfutr6L2iuL4da67vF7vR_4D1zXOKb4_0pCVtamREhGsDm_Y-iMImBPg\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<p>hoon 계정으로 POST 요청을 했고 해당 토큰을 이용해서 다시 API 를 호출하겠습니다.</p>\n<ul>\n<li>\n<p>Response - <code class=\"language-text\">GET</code> /api/user/hoon</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"timestamp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2022-01-13T13:15:29.386+00:00\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token number\">403</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"error\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Forbidden\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/api/user/hoon\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<p>hoon 계정의 토큰으로 요청을 해보면 <code class=\"language-text\">403 Foribidden</code> 에러가 반환된 것을 볼수있습니다.</p>\n<p>해당 403 Forbidden 에러는 저희가 작성한 <code class=\"language-text\">JwtAccessDeniedHandler</code>에 의해 발생됬습니다.</p>\n<p>이번에는 USER권한을 허용해줬던 API를 hoon 계정의 토큰으로 호출해보겠습니다.</p>\n<ul>\n<li>\n<p>Response - <code class=\"language-text\">GET</code> /api/user</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"username\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hoon\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"nickname\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nick\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"authorityDtoSet\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"authorityName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ROLE_USER\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<p>hoon 계정으로 발급받은 토큰으로 이 API 는 잘 호출되는 것을 볼수있습니다.</p>\n<p>이제 해당 강의에서 준비한 JWT Tutorial의 모든 부분이 완료됬습니다. 읽어주셔서 감사합니다😊</p>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<p><a href=\"https://gaemi606.tistory.com/entry/Spring-Boot-Spring-Security-PreAuthorize%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://gaemi606.tistory.com/entry/Spring-Boot-Spring-Security-PreAuthorize사용하기</a></p>\n<p><a href=\"https://steemit.com/kr-dev/@igna84/spring-security-preauthorize-postauthorize\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://steemit.com/kr-dev/@igna84/spring-security-preauthorize-postauthorize</a></p>","excerpt":"1. 회원가입 API 작성 SecurityUtil 클래스 간단한 유틸리티 메소드를 만들기 위해  클래스를 util 패키지에 생성하겠습니다.  메소드의 역활은 SecurityContext의 Authentication 객체를 이용해 을 리턴해주는 간단한…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/springboot-jwt-tutorial5/#1-%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85-api-%EC%9E%91%EC%84%B1\">1. 회원가입 API 작성</a></p>\n<ul>\n<li><a href=\"/springboot-jwt-tutorial5/#securityutil-%ED%81%B4%EB%9E%98%EC%8A%A4\">SecurityUtil 클래스</a></li>\n<li><a href=\"/springboot-jwt-tutorial5/#userservice-%ED%81%B4%EB%9E%98%EC%8A%A4\">UserService 클래스</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/springboot-jwt-tutorial5/#2-%EA%B6%8C%ED%95%9C-%EA%B2%80%EC%A6%9D\">2. 권한 검증</a></p>\n<ul>\n<li><a href=\"/springboot-jwt-tutorial5/#usercontroller-%ED%81%B4%EB%9E%98%EC%8A%A4\">UserController 클래스</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/springboot-jwt-tutorial5/#3-response-%EC%8B%9C-dto%EB%A5%BC-%ED%86%B5%ED%95%B4%EC%84%9C%EB%A7%8C-%EB%B0%9B%EA%B8%B0\">3. Response 시 DTO를 통해서만 받기</a></p>\n<ul>\n<li><a href=\"/springboot-jwt-tutorial5/#%EA%B8%B0%EC%A1%B4-%EB%AC%B8%EC%A0%9C%EC%A0%90\">기존 문제점</a></li>\n<li>\n<p><a href=\"/springboot-jwt-tutorial5/#%ED%95%B4%EA%B2%B0%EB%B2%95\">해결법</a></p>\n<ul>\n<li><a href=\"/springboot-jwt-tutorial5/#authoritydto-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%83%9D%EC%84%B1\">AuthorityDto 클래스 생성</a></li>\n<li><a href=\"/springboot-jwt-tutorial5/#userdto-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%88%98%EC%A0%95\">UserDto 클래스 수정</a></li>\n<li><a href=\"/springboot-jwt-tutorial5/#userservice-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%88%98%EC%A0%95\">UserService 클래스 수정</a></li>\n<li><a href=\"/springboot-jwt-tutorial5/#usercontroller-%ED%81%B4%EB%9E%98%EC%8A%A4-%EC%88%98%EC%A0%95\">UserController 클래스 수정</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/springboot-jwt-tutorial5/#4-%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85-api-%ED%85%8C%EC%8A%A4%ED%8A%B8\">4. 회원가입 API 테스트</a></p>\n<ul>\n<li>\n<p><a href=\"/springboot-jwt-tutorial5/#%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85-%EC%9A%94%EC%B2%AD\">회원가입 요청</a></p>\n<ul>\n<li><a href=\"/springboot-jwt-tutorial5/#h2-console\">H2 Console</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/springboot-jwt-tutorial5/#%EA%B6%8C%ED%95%9C-api-%ED%85%8C%EC%8A%A4%ED%8A%B8\">권한 API 테스트</a></p>\n<ul>\n<li><a href=\"/springboot-jwt-tutorial5/#jwt-token-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\">JWT Token 가져오기</a></li>\n<li><a href=\"/springboot-jwt-tutorial5/#admin-%EA%B6%8C%ED%95%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8\">ADMIN 권한 테스트</a></li>\n<li><a href=\"/springboot-jwt-tutorial5/#user-%EA%B6%8C%ED%95%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8\">USER 권한 테스트</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/springboot-jwt-tutorial5/#reference\">Reference</a></li>\n</ul>","fields":{"slug":"/springboot-jwt-tutorial5/"},"frontmatter":{"title":"SpringBoot JWT 튜토리얼 - 5장 회원가입, 권한검증 [최종]","date":"Jan 14, 2022","tags":["SpringBoot","JWT","튜토리얼"],"keywords":["스프링","스프링부트","SpringBoot","JWT","튜토리얼","Tutorial","Login","로그인"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/springboot-jwt-tutorial5/","series":[],"lastmod":"2022-01-14"}},"staticQueryHashes":["2027115977","694178885"]}