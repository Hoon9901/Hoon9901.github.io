{"componentChunkName":"component---src-templates-post-tsx","path":"/image-upload-view/","result":{"data":{"markdownRemark":{"html":"<p>필자가 진행하는 토이 프로젝트 냥피스에서는 이미지를 업로드 하는 기능과 이미지 조회 기능을 제공한다.\n해당 기능을 구현하기 위해서 도움이 될만한 내용이 있으므로 이 기능을 구현하기 위한 분들은 읽어보면 좋을 것 이다.</p>\n<h1 id=\"get-started\" style=\"position:relative;\"><a href=\"#get-started\" aria-label=\"get started permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Get Started</h1>\n<h2 id=\"1-이미지-업로드-구현하기\" style=\"position:relative;\"><a href=\"#1-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%97%85%EB%A1%9C%EB%93%9C-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\" aria-label=\"1 이미지 업로드 구현하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 이미지 업로드 구현하기</h2>\n<p>만약에 글을 생성할때 이미지 파일과 같이 단일 API로 처리할 수 있다. 이러한 요구사항은\n이미지 업로드 시에 MultiPartFile 뿐만 아니라 DTO도 함께 처리할 수 있도록 코드를 작성하면된다\n다음 내용들은 이러한 요구사항을 토대로 작성했다.</p>\n<h3 id=\"11-multipart-config-설정\" style=\"position:relative;\"><a href=\"#11-multipart-config-%EC%84%A4%EC%A0%95\" aria-label=\"11 multipart config 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.1 MultiPart Config 설정</h3>\n<p>우선 MultiPartFile에 대해 최대 사이즈 설정을 해준다.\n이미지 파일을 업로드하기 때문에 기본값보다 높은 용량으로 제한해준다.\n다음과 같이 설정을 추가한다. (<a href=\"https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/autoconfigure/web/servlet/MultipartProperties.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MultipartProperties</a>)</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n\t  <span class=\"token key atrule\">servlet</span><span class=\"token punctuation\">:</span>\n\t    <span class=\"token key atrule\">multipart</span><span class=\"token punctuation\">:</span>\n\t      <span class=\"token key atrule\">max-file-size</span><span class=\"token punctuation\">:</span> 10MB\n\t      <span class=\"token key atrule\">max-request-size</span><span class=\"token punctuation\">:</span> 10MB</code></pre></div>\n<ul>\n<li>max-file-size: 업로드된 파일에 허용되는 최대 크기를 지정. (기본값은 1MB)</li>\n<li>max-request-size: multipart/form-data 요청에 허용되는 최대 크기를 지정. (기본값은 10MB)</li>\n</ul>\n<p>그외 MultiPart 업로드에 대한 설정이 있다. 기본적으로 Multipart 기능이 활성화 (<code class=\"language-text\">spring.servlet.multipart.enabled : true</code>) 되어있다.\n업로드된 파일의 임시 저장 공간을 설정할 수 있는 설정도 있다. (multipart.location) 추가적으로 관리가 필요하면 해당 경로도 지정하면 좋다. 임시적으로 저장되는 경로라 요청이 처리 된 후에는 자동으로 파일이 삭제된다.</p>\n<h3 id=\"12-upload-controller\" style=\"position:relative;\"><a href=\"#12-upload-controller\" aria-label=\"12 upload controller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.2 Upload Controller</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@PostMapping</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span> <span class=\"token function\">upload</span><span class=\"token punctuation\">(</span>\n            <span class=\"token annotation punctuation\">@RequestPart</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dto\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> dto<span class=\"token punctuation\">,</span>\n            <span class=\"token annotation punctuation\">@RequestPart</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"image\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">MultipartFile</span> image<span class=\"token punctuation\">)</span>  <span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">// 확장자 추출</span>\n        <span class=\"token class-name\">String</span> originalFilename <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span><span class=\"token function\">getOriginalFilename</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> index <span class=\"token operator\">=</span> originalFilename<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> ext <span class=\"token operator\">=</span> originalFilename<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>ext<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"이미지 파일만 업로드 가능합니다.\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">BAD_REQUEST</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n\n        <span class=\"token class-name\">String</span> savePath <span class=\"token operator\">=</span> <span class=\"token string\">\"./images/\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> storeFileName <span class=\"token operator\">=</span> <span class=\"token constant\">UUID</span><span class=\"token punctuation\">.</span><span class=\"token function\">randomUUID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".\"</span> <span class=\"token operator\">+</span> ext<span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> now <span class=\"token operator\">=</span> <span class=\"token class-name\">LocalDateTime</span><span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DateTimeFormatter</span><span class=\"token punctuation\">.</span><span class=\"token function\">ofPattern</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yyyy-MM-dd\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">String</span> key <span class=\"token operator\">=</span> savePath <span class=\"token operator\">+</span> now <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> storeFileName<span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">File</span> temp <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>savePath <span class=\"token operator\">+</span> now <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>temp<span class=\"token punctuation\">.</span><span class=\"token function\">exists</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                temp<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token class-name\">FileOutputStream</span> fileOutputStream <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileOutputStream</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            fileOutputStream<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            fileOutputStream<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            dto<span class=\"token punctuation\">.</span><span class=\"token function\">setImageUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/images/\"</span> <span class=\"token operator\">+</span> now <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> storeFileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">IOException</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"이미지 저장에 실패했습니다.\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">INTERNAL_SERVER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        \n\t\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>MultipartFile에 대해 확장자 유효성 검증을 처리하고 파일 저장을 하는 로직이 있다. 메서드 파라미터를 보면은 이미지 파일 뿐만 아니라 DTO 객체도 받아오는데. MultiPartFile과 JSON 요청을 같이 처리할려면  <code class=\"language-text\">@ReqeustPart</code> (@RequestBody가 아니다!)로 DTO를 받아야한다. 그렇지 않으면 스프링에서 예외가 발생한다. MultiPartFile로 DTO를 받고 해당 DTO는 요청시에 Content-Type을 application/json으로 지정하면 정상적으로 스프링에서 처리된다. 추가적으로 유효성 검증을 할때 파일의 위변조까지 체크할려면 추가적으로 <a href=\"https://tika.apache.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Apache Tika 라이브러리</a>를 이용하면 된다.</p>\n<p>이미지가 저장되는 경로는 프로젝트 경로의 <code class=\"language-text\">images/2023-05-01/</code> 형식의 폴더로 저장되고 저장되는 파일명은 중복성을 고려하여 UUID를 이용해서 저장된다. 따라서 파일이 업로드 되면 다음과 같이 저장되는 모습이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">./\n├── README.md\n├── build/\n├── gradle/\n├── gradlew\n├── gradlew.bat\n├── images\n│   └── <span class=\"token number\">2023</span>-05-01\n│       ├── 0e04033c-c69b-4840-a17d-8052fb32653e.jpeg\n│       ├── 27fe8ce7-8bca-4642-8f0d-756fb0a4e1a2.jpeg\n│       ├── 34d274ca-6602-4305-979d-f28cdbdf8a91.jpeg\n│       ├── 70558e10-d795-4358-b443-07e6fc469ee2.jpeg\n│       ├── 88c6b931-b000-45c6-a5fb-ace650b54cb7.jpeg\n│       ├── 9452b9c8-3a09-4fb1-9052-231945701526.jpeg\n│       ├── 9572aa83-982c-4a45-8e9d-1164d1b375a0.jpeg\n│       ├── 97c0f0b6-e601-40ae-808f-1f92ec94974b.jpeg\n│       ├── d83dbdc6-ee63-49f4-b8e5-73c8049d069a.jpeg\n│       ├── ec24b9f6-c57e-4935-8e0c-1d27d08daee5.jpeg\n│       ├── fae23d62-57ec-4a93-9a96-cd7068c93dc7.jpeg\n│       └── ffa7a8bf-f984-4c08-9cb1-de66655ae81f.jpeg\n├── settings.gradle\n└── src\n    ├── main\n    │   ├── <span class=\"token function\">java</span>\n    │   └── resources\n    └── <span class=\"token builtin class-name\">test</span>\n        └── <span class=\"token function\">java</span></code></pre></div>\n<p>스프링을 jar 파일로 실행해서 기능을 수행한다면 jar 파일이 위치한 경로에서 저장된다.</p>\n<h3 id=\"13-이미지-업로드-api\" style=\"position:relative;\"><a href=\"#13-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%97%85%EB%A1%9C%EB%93%9C-api\" aria-label=\"13 이미지 업로드 api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.3 이미지 업로드 API</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b85f153c1b21d99e0d20273c2099679f/f4b77/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVQ4y6VTSW4VMRD18bgQB0DiGFwA1uzCjk0gApJI6BMhhihRyO/ZPXloux/1nDgTUfQlLD1Vd7nquUblvYdzDlprDMOAXQ7ti6LAOI5YQhDNCoQe8ANU0zTo2haTXLYi+V/XNaqqSpKPzPOMaZpuQCLqCWdmPH874NmrDi/2Rig9ioE4zH4Rwg5lXaEoS1QiSUqnTMLIrLX3sHiHN0cWL99NeH1oocYv+9CHH2GODrAsC5YY4EadDFfJJMYIloXY5Sj38wR6c4zw+/uVZr29JAkfyWeVF3gdf53Aip//+hkY5PH1qq5eslR/tgU6aQhPpIOAUVEaYxLpeq0nUlN+fEPxaR/Nh/eIQhhFx/RJqjabDbaXl5Kiv43i2pG1Y5NyswjqnERtpO7scLxjT6mY0sMoMnLKOeoceRCikMYF//iox4j+B+qpjj2s3W5dlkIyfKbGbxf8o2PC+8kZmVdCZnBxMPKf5zHzqPLi/GYjdK/R6i59swE0zAPNbSFJBh+23qWHaceJSIS671HKRlBBzOwiCUTSkOQ5gqdKQ7I0NiyP5zZwn7dbdD3HIu5cs7v1TRFylnxcYWV/+9NT1E2Hs3LCRT2hHR2q3qLUBs1gUct3lu3g0n0I8V4D/wK+6Y/sxgfh6wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/b85f153c1b21d99e0d20273c2099679f/fcda8/1.png\"\n        srcset=\"/static/b85f153c1b21d99e0d20273c2099679f/12f09/1.png 148w,\n/static/b85f153c1b21d99e0d20273c2099679f/e4a3f/1.png 295w,\n/static/b85f153c1b21d99e0d20273c2099679f/fcda8/1.png 590w,\n/static/b85f153c1b21d99e0d20273c2099679f/f4b77/1.png 770w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n위와 같이 이미지 업로드 API를 호출한 모습이다. 이미지 뿐만아니라 추가적인 JSON 형식의 요청도 처리하는 API 이다.\n이러한 API (Form-data에 json 형식의 dto와 image를 사용하는 것)를 사용하는 Frontend 에서는 다음 코드를 참고하여 사용하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// axios를 이용한 api 호출 코드</span>\n<span class=\"token keyword\">const</span> axios <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'axios'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> FormData <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'form-data'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndata<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dto'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'{\\n  \"description\": \"string\",\\n  \"name\": \"string\",\\n  \"prize\": 1000\\n}'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token literal-property property\">contentType</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ndata<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image'</span><span class=\"token punctuation\">,</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'BAE171ED-8C6A-4D86-B855-79E26B3D2FD5.jpeg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> <span class=\"token string\">'post'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">maxBodyLength</span><span class=\"token operator\">:</span> <span class=\"token number\">Infinity</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost:8080/api/wanted'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token operator\">...</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">getHeaders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">data</span> <span class=\"token operator\">:</span> data\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\naxios<span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"2-이미지-조회-구현하기\" style=\"position:relative;\"><a href=\"#2-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%A1%B0%ED%9A%8C-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\" aria-label=\"2 이미지 조회 구현하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 이미지 조회 구현하기</h2>\n<p>저장된 이미지를 조회하기 위해서 저장된 이미지 파일들을 정적 리소스로 관리하여 불러올 수 있도록 스프링 서버를 설정한다.</p>\n<p>위 이미지 업로드를 구현하면 이미지의 저장경로는 <code class=\"language-text\">/images/2023-05-02/5a3f680c-6d6a-4de4-a283-6d6f12c221c1.jpeg</code> 와 같이 구성되는데. 해당 경로 그대로 <code class=\"language-text\">localhost:8080/images/2023-05-02/5a3f680c-6d6a-4de4-a283-6d6f12c221c1.jpeg</code>  와 같이 호출할 수 있도록 기능을 구현하였다.\n즉 스프링 정적 리소스를 조회할때 images/ 경로로 요청이 들어오면은 images/ 폴더 경로에 있는 리소스들을 조회할 수 있도록 설정한다.</p>\n<h3 id=\"21-uploadpath-config-설정\" style=\"position:relative;\"><a href=\"#21-uploadpath-config-%EC%84%A4%EC%A0%95\" aria-label=\"21 uploadpath config 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.1 UploadPath Config 설정</h3>\n<p>application.yaml에 다음 설정을 추가한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">uploadPath</span><span class=\"token punctuation\">:</span> file<span class=\"token punctuation\">:</span>./images/ <span class=\"token comment\"># Linux, Mac 경로</span></code></pre></div>\n<p>만약에 윈도우 환경에서 서버를 실행한다면 다음과 같은 경로로 지정해야한다.\n<code class=\"language-text\">file:///./images/</code> 또는 <code class=\"language-text\">file:///C:images/</code> </p>\n<h3 id=\"22-webmvcconfiguration\" style=\"position:relative;\"><a href=\"#22-webmvcconfiguration\" aria-label=\"22 webmvcconfiguration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.2 WebMvcConfiguration</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebMvcConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Value</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"${uploadPath}\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> uploadPath<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addResourceHandlers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ResourceHandlerRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        registry\n                <span class=\"token punctuation\">.</span><span class=\"token function\">addResourceHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/images/**\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">addResourceLocations</span><span class=\"token punctuation\">(</span>uploadPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">WebMvcConfigurer</code>를 구현한 <code class=\"language-text\">@Configuration</code> 클래스를 작성한다.\n설정한 uploadPath 속성값을 불러오고 <code class=\"language-text\">addResourceHandlers</code> 메소드를 오버라이드하여 <code class=\"language-text\">/images/**</code> 경로의 요청들은 지정한 uploadPath로 리소스 파일을 찾을 수 있도록 코드를 작성했다.</p>\n<p>즉 <a href=\"\">localhost:8080/images/2023-05-02/5a3f680c-6d6a-4de4-a283-6d6f12c221c1.jpeg</a> 링크를 누르면 업로드된 이미지가 조회될 것 이다. </p>\n<p>만약에 Spring Security를 사용하면 httpSecurity에서 <code class=\"language-text\">/images/**</code> 경로를 permitAll 처리를 해줘야한다.</p>\n<h3 id=\"23-이미지-조회-결과\" style=\"position:relative;\"><a href=\"#23-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%A1%B0%ED%9A%8C-%EA%B2%B0%EA%B3%BC\" aria-label=\"23 이미지 조회 결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.3 이미지 조회 결과</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cbbb376d81bfeaeeee272a8a6a150aa3/108f8/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADAklEQVQ4y32T60/TVxjHebc3y5Zs/8qyLCG+MfGNZstimNE5ooky5hKU2fgGBhOzsCJBmbOAFypdkeINuworhGGg4VJbCr1Kf21/l15p6/TNRMla+Oz8CjMxiif55nsueT7neZ6TU7W29oLn2yoUn5DO5Mhkc+RWC+TyBfKFItlcvrJezesqbp9t+d9Pn/Hi5Uv+eb5WUVV5Y4MNoVKpRDiq4Q0k8AVlFv2ycIVFXQFZ7G/JsxTH7Yux4Isz7V4hrubRR6lcrnCq2B76Qoon8YdkAhGV5ZCCP6wJ1/AFFAFX8S4nBCjGvC/BnFdmal4iphUr8ZubmxWv+n+iAxOySmQlhhRTiUqa8DQrK+ISkbHPHxfAGB4BfSSy9/g1XN4E8dQWcENwdNZrQEURoGgMVVFIahqZdI50qkA6rauIJoKj8SxhKUNIyuH2q8jpJ6+Ab2QoRSUiocekkkmSqg7MkkmlmJlw8MBmYXZyQlyooKaeEYhmmVuWkTPvAIaCy3g9buYeOkkqCaRImJEhC22NdRzZ/QmnavZg7e0mEo5VerckoGr26U49LBP0u/G4XdwyX6b/wlmM51o429JCq+Ekpw5+TlvDMX49b2TQYiUYiDDpHBcPqbxK6M2SgwssLUyxNOtk/55dfPzBR5z+7hgX25ppP32C800/0HqmkS/37qN2/xfcvNZDKvuOkvPxBWTfnzwYNHG8tpbdn1VztfNnHAO9DF/uYuS6iaaGE3z43vtUf1qNfXiI7OpOJZdL/JubR1u0c6PvN3ovduAYvsn0qB374AD3bvQxNjSA3TaMoaGRn5p/pL+vt/KQby15fX0dQ2M93e0tWPuvMfaHHdfkX9isNozGbjo7uui/Ymb0vgPn2Di/my1cvzqAz+t9O1D/et+Ixh89sJfROzbmXbPcvX2P1tZfaDjZTFNzO8YOE9YhOw9nvNy568B0ycSj2ZmdgbdM5zAbDUxPjHGlp4f6b7/nQM0Rvqo5yuHDx/n6UB119QbMlhGc4zNc6urE7Zp6DfgfybCu/09L0U8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0\"\n        title=\"0\"\n        src=\"/static/cbbb376d81bfeaeeee272a8a6a150aa3/fcda8/0.png\"\n        srcset=\"/static/cbbb376d81bfeaeeee272a8a6a150aa3/12f09/0.png 148w,\n/static/cbbb376d81bfeaeeee272a8a6a150aa3/e4a3f/0.png 295w,\n/static/cbbb376d81bfeaeeee272a8a6a150aa3/fcda8/0.png 590w,\n/static/cbbb376d81bfeaeeee272a8a6a150aa3/108f8/0.png 777w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>이미지 업로드와 조회를 간단하게 구현해봤다. 이러한 기능들을 실제 배포를 위해서 구현한다면 이미지의 특성상 요청 크기가 매우 무겁기 때문에 미들웨어로 CDN과 같은 캐싱 서버를 둬서 리소스를 캐싱해서 제공하거나, 이미지의 크기가 요즘은 4K 이상은 넘기는 경우가 있으니 클라이언트에 보낼때 이미지 리사이징 기능을 적용하는 방법들을 고안해야한다....! </p>\n<h1 id=\"레퍼런스\" style=\"position:relative;\"><a href=\"#%EB%A0%88%ED%8D%BC%EB%9F%B0%EC%8A%A4\" aria-label=\"레퍼런스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>레퍼런스</h1>\n<p><a href=\"https://velog.io/@orol116/Spring-%EC%9D%B4%EB%AF%B8%EC%A7%80%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://velog.io/@orol116/Spring-이미지파일-업로드</a></p>\n<p><a href=\"https://gilssang97.tistory.com/43\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://gilssang97.tistory.com/43</a></p>\n<p><a href=\"https://creampuffy.tistory.com/119\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://creampuffy.tistory.com/119</a></p>\n<p><a href=\"https://velog.io/@nestour95/Spring-boot-%EC%A0%95%EC%A0%81-%EB%A6%AC%EC%86%8C%EC%8A%A4%EB%A5%BC-%EC%99%B8%EB%B6%80-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC%EB%A1%9C-%EB%B6%80%ED%84%B0-%EB%B6%88%EB%9F%AC%EC%98%A4%EA%B8%B0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://velog.io/@nestour95/Spring-boot-정적-리소스를-외부-디렉토리로-부터-불러오기</a></p>","excerpt":"필자가 진행하는 토이 프로젝트 냥피스에서는 이미지를 업로드 하는 기능과 이미지 조회 기능을 제공한다.\n해당 기능을 구현하기 위해서 도움이 될만한 내용이 있으므로 이 기능을 구현하기 위한 분들은 읽어보면 좋을 것 이다. Get Started 1. 이미…","tableOfContents":"<ul>\n<li>\n<p><a href=\"/image-upload-view/#get-started\">Get Started</a></p>\n<ul>\n<li>\n<p><a href=\"/image-upload-view/#1-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%97%85%EB%A1%9C%EB%93%9C-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\">1. 이미지 업로드 구현하기</a></p>\n<ul>\n<li><a href=\"/image-upload-view/#11-multipart-config-%EC%84%A4%EC%A0%95\">1.1 MultiPart Config 설정</a></li>\n<li><a href=\"/image-upload-view/#12-upload-controller\">1.2 Upload Controller</a></li>\n<li><a href=\"/image-upload-view/#13-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%97%85%EB%A1%9C%EB%93%9C-api\">1.3 이미지 업로드 API</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/image-upload-view/#2-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%A1%B0%ED%9A%8C-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0\">2. 이미지 조회 구현하기</a></p>\n<ul>\n<li><a href=\"/image-upload-view/#21-uploadpath-config-%EC%84%A4%EC%A0%95\">2.1 UploadPath Config 설정</a></li>\n<li><a href=\"/image-upload-view/#22-webmvcconfiguration\">2.2 WebMvcConfiguration</a></li>\n<li><a href=\"/image-upload-view/#23-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%A1%B0%ED%9A%8C-%EA%B2%B0%EA%B3%BC\">2.3 이미지 조회 결과</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/image-upload-view/#%EB%A0%88%ED%8D%BC%EB%9F%B0%EC%8A%A4\">레퍼런스</a></li>\n</ul>","fields":{"slug":"/image-upload-view/"},"frontmatter":{"title":"[Spring] 간단한 이미지 업로드 및 정적 리소스를 통한 이미지 조회를 구현해보자.","date":"May 02, 2023","tags":["Spring","upload","multipart"],"keywords":["Spring","SpringBoot","File","multipart","이미지업로드","정적리소스"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/image-upload-view/","series":[],"lastmod":"2023-05-02"}},"staticQueryHashes":["2027115977","694178885"]}